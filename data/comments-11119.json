[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1089095151",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11119#issuecomment-1089095151",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11119",
        "id": 1089095151,
        "node_id": "IC_kwDOCVq1mM5A6kXv",
        "user": {
            "login": "wangyems",
            "id": 52801275,
            "node_id": "MDQ6VXNlcjUyODAxMjc1",
            "avatar_url": "https://avatars.githubusercontent.com/u/52801275?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/wangyems",
            "html_url": "https://github.com/wangyems",
            "followers_url": "https://api.github.com/users/wangyems/followers",
            "following_url": "https://api.github.com/users/wangyems/following{/other_user}",
            "gists_url": "https://api.github.com/users/wangyems/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/wangyems/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/wangyems/subscriptions",
            "organizations_url": "https://api.github.com/users/wangyems/orgs",
            "repos_url": "https://api.github.com/users/wangyems/repos",
            "events_url": "https://api.github.com/users/wangyems/events{/privacy}",
            "received_events_url": "https://api.github.com/users/wangyems/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-05T17:35:29Z",
        "updated_at": "2022-04-05T17:35:29Z",
        "author_association": "MEMBER",
        "body": "Can you try without the symbolic shape infer:\r\noptimized_model.convert_float_to_float16(use_symbolic_shape_infer=False)",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1089095151/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1089133082",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11119#issuecomment-1089133082",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11119",
        "id": 1089133082,
        "node_id": "IC_kwDOCVq1mM5A6toa",
        "user": {
            "login": "VikasOjha666",
            "id": 35727142,
            "node_id": "MDQ6VXNlcjM1NzI3MTQy",
            "avatar_url": "https://avatars.githubusercontent.com/u/35727142?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/VikasOjha666",
            "html_url": "https://github.com/VikasOjha666",
            "followers_url": "https://api.github.com/users/VikasOjha666/followers",
            "following_url": "https://api.github.com/users/VikasOjha666/following{/other_user}",
            "gists_url": "https://api.github.com/users/VikasOjha666/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/VikasOjha666/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/VikasOjha666/subscriptions",
            "organizations_url": "https://api.github.com/users/VikasOjha666/orgs",
            "repos_url": "https://api.github.com/users/VikasOjha666/repos",
            "events_url": "https://api.github.com/users/VikasOjha666/events{/privacy}",
            "received_events_url": "https://api.github.com/users/VikasOjha666/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-05T18:07:21Z",
        "updated_at": "2022-04-05T18:07:21Z",
        "author_association": "NONE",
        "body": "@wangyems  Thanks for your time and the answer. Setting the above option solved the issue. Thanks for the quick response again.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1089133082/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1090318910",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11119#issuecomment-1090318910",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11119",
        "id": 1090318910,
        "node_id": "IC_kwDOCVq1mM5A_PI-",
        "user": {
            "login": "VikasOjha666",
            "id": 35727142,
            "node_id": "MDQ6VXNlcjM1NzI3MTQy",
            "avatar_url": "https://avatars.githubusercontent.com/u/35727142?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/VikasOjha666",
            "html_url": "https://github.com/VikasOjha666",
            "followers_url": "https://api.github.com/users/VikasOjha666/followers",
            "following_url": "https://api.github.com/users/VikasOjha666/following{/other_user}",
            "gists_url": "https://api.github.com/users/VikasOjha666/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/VikasOjha666/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/VikasOjha666/subscriptions",
            "organizations_url": "https://api.github.com/users/VikasOjha666/orgs",
            "repos_url": "https://api.github.com/users/VikasOjha666/repos",
            "events_url": "https://api.github.com/users/VikasOjha666/events{/privacy}",
            "received_events_url": "https://api.github.com/users/VikasOjha666/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-06T14:10:16Z",
        "updated_at": "2022-04-06T14:58:47Z",
        "author_association": "NONE",
        "body": "@wangyems @tianleiwu @sam-writer  Sorry to revive this issue again. But when I am doing prediction using the above decoder I am getting this issue:\r\n\r\nRuntimeException: [ONNXRuntimeError] : 6 : RUNTIME_EXCEPTION : Non-zero status code returned while running Cast node. Name:'graph_input_cast5' Status Message: /onnxruntime_src/onnxruntime/core/framework/op_kernel.cc:78 OrtValue* onnxruntime::OpKernelContext::OutputMLValue(int, const onnxruntime::TensorShape&) status.IsOK() was false. Shape mismatch attempting to re-use buffer. {4,12,1,64} != {4,12,163,64}. Validate usage of dim_value (values should be > 0) and dim_param (all values with the same string should equate to the same size) in shapes in the model.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1090318910/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1090331232",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11119#issuecomment-1090331232",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11119",
        "id": 1090331232,
        "node_id": "IC_kwDOCVq1mM5A_SJg",
        "user": {
            "login": "VikasOjha666",
            "id": 35727142,
            "node_id": "MDQ6VXNlcjM1NzI3MTQy",
            "avatar_url": "https://avatars.githubusercontent.com/u/35727142?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/VikasOjha666",
            "html_url": "https://github.com/VikasOjha666",
            "followers_url": "https://api.github.com/users/VikasOjha666/followers",
            "following_url": "https://api.github.com/users/VikasOjha666/following{/other_user}",
            "gists_url": "https://api.github.com/users/VikasOjha666/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/VikasOjha666/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/VikasOjha666/subscriptions",
            "organizations_url": "https://api.github.com/users/VikasOjha666/orgs",
            "repos_url": "https://api.github.com/users/VikasOjha666/repos",
            "events_url": "https://api.github.com/users/VikasOjha666/events{/privacy}",
            "received_events_url": "https://api.github.com/users/VikasOjha666/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-06T14:21:51Z",
        "updated_at": "2022-04-06T14:58:59Z",
        "author_association": "NONE",
        "body": "@wangyems @tianleiwu @sam-writer The same issue was coming in the fp16 version of decoder_init which is the version of decoder with inputs: input_ids,attention_mask and encoder_ouputs. But setting use_symbolic_shape_infer=False did solved this issue in decoder init. But I am already doing the same for decoder and I am getting this issue. Could you please suggest any fix?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1090331232/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1090532525",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11119#issuecomment-1090532525",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11119",
        "id": 1090532525,
        "node_id": "IC_kwDOCVq1mM5BADSt",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-06T17:33:40Z",
        "updated_at": "2022-04-06T17:38:48Z",
        "author_association": "MEMBER",
        "body": "@VikasOjha666, Does fp32 version has same error?\r\n\r\nconvert_float_to_float16 by default will get a model with most computation in fp16. This will cause accuracy loss. You will need mixed precision: [layer normalization](https://github.com/huggingface/transformers/blob/4d100835394b54790bd98018fdcb9ea82e52480e/src/transformers/models/t5/modeling_t5.py#L251-L252) and activation (Relu) etc need to be computed in fp32. The layer normalization is like the following:\r\n![image](https://user-images.githubusercontent.com/30328909/162028687-1e7daffa-3511-4088-b1ce-1099e1fa0093.png)\r\n\r\nYou will need add [op_block_list or node_block_list](https://github.com/microsoft/onnxruntime/blob/5e197698b8964875bb9b979070c325b51bb0228a/onnxruntime/python/tools/transformers/onnx_model.py#L510-L512) parameter like\r\n```\r\noptimized_model.convert_float_to_float16(use_symbolic_shape_infer=False, keep_io_types=False, op_block_list=[\"Pow\", \"ReduceMean\", \"Add\", \"Sqrt\", \"Div\", \"Mul\", \"Softmax\", \"Relu\"])\r\n```\r\n\r\nTo get better performance, the past key values need to be in fp16, and keep_io_types=False could achieve that. \r\n\r\nYou might notice that past state for cross attention does not change (they are copied from input to output):\r\n![image](https://user-images.githubusercontent.com/30328909/162033835-d40c6462-8be5-43da-ae6d-672b952cddf2.png)\r\nSo they need not be in outputs. You can follow https://github.com/microsoft/onnxruntime/blob/master/onnxruntime/python/tools/transformers/models/t5/convert_to_onnx.py to get a model without those outputs.\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1090532525/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1091117689",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11119#issuecomment-1091117689",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11119",
        "id": 1091117689,
        "node_id": "IC_kwDOCVq1mM5BCSJ5",
        "user": {
            "login": "VikasOjha666",
            "id": 35727142,
            "node_id": "MDQ6VXNlcjM1NzI3MTQy",
            "avatar_url": "https://avatars.githubusercontent.com/u/35727142?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/VikasOjha666",
            "html_url": "https://github.com/VikasOjha666",
            "followers_url": "https://api.github.com/users/VikasOjha666/followers",
            "following_url": "https://api.github.com/users/VikasOjha666/following{/other_user}",
            "gists_url": "https://api.github.com/users/VikasOjha666/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/VikasOjha666/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/VikasOjha666/subscriptions",
            "organizations_url": "https://api.github.com/users/VikasOjha666/orgs",
            "repos_url": "https://api.github.com/users/VikasOjha666/repos",
            "events_url": "https://api.github.com/users/VikasOjha666/events{/privacy}",
            "received_events_url": "https://api.github.com/users/VikasOjha666/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-07T06:11:08Z",
        "updated_at": "2022-04-07T06:11:08Z",
        "author_association": "NONE",
        "body": "@tianleiwu No fp32 model doesn't have this issue.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1091117689/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1091386121",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11119#issuecomment-1091386121",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11119",
        "id": 1091386121,
        "node_id": "IC_kwDOCVq1mM5BDTsJ",
        "user": {
            "login": "VikasOjha666",
            "id": 35727142,
            "node_id": "MDQ6VXNlcjM1NzI3MTQy",
            "avatar_url": "https://avatars.githubusercontent.com/u/35727142?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/VikasOjha666",
            "html_url": "https://github.com/VikasOjha666",
            "followers_url": "https://api.github.com/users/VikasOjha666/followers",
            "following_url": "https://api.github.com/users/VikasOjha666/following{/other_user}",
            "gists_url": "https://api.github.com/users/VikasOjha666/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/VikasOjha666/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/VikasOjha666/subscriptions",
            "organizations_url": "https://api.github.com/users/VikasOjha666/orgs",
            "repos_url": "https://api.github.com/users/VikasOjha666/repos",
            "events_url": "https://api.github.com/users/VikasOjha666/events{/privacy}",
            "received_events_url": "https://api.github.com/users/VikasOjha666/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-07T09:08:20Z",
        "updated_at": "2022-04-07T09:09:41Z",
        "author_association": "NONE",
        "body": "@tianleiwu  @wangyems \r\nI converted the model using this script:optimized_model.convert_float_to_float16(use_symbolic_shape_infer=False, keep_io_types=False, op_block_list=[\"Pow\", \"ReduceMean\", \"Add\", \"Sqrt\", \"Div\", \"Mul\", \"Softmax\", \"Relu\"]) but now I am getting different error. While loading the inference session from the converted model file, I am getting the below error:\r\n\r\nFail: [ONNXRuntimeError] : 1 : FAIL : Load model from /content/optimized_models/t5-base-qa-qg-hl-decoder.onnx failed:Type Error: Type parameter (T) of Optype (Add) bound to different types (tensor(float16) and tensor(float) in node (Add_73).",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1091386121/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1091645944",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11119#issuecomment-1091645944",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11119",
        "id": 1091645944,
        "node_id": "IC_kwDOCVq1mM5BETH4",
        "user": {
            "login": "VikasOjha666",
            "id": 35727142,
            "node_id": "MDQ6VXNlcjM1NzI3MTQy",
            "avatar_url": "https://avatars.githubusercontent.com/u/35727142?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/VikasOjha666",
            "html_url": "https://github.com/VikasOjha666",
            "followers_url": "https://api.github.com/users/VikasOjha666/followers",
            "following_url": "https://api.github.com/users/VikasOjha666/following{/other_user}",
            "gists_url": "https://api.github.com/users/VikasOjha666/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/VikasOjha666/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/VikasOjha666/subscriptions",
            "organizations_url": "https://api.github.com/users/VikasOjha666/orgs",
            "repos_url": "https://api.github.com/users/VikasOjha666/repos",
            "events_url": "https://api.github.com/users/VikasOjha666/events{/privacy}",
            "received_events_url": "https://api.github.com/users/VikasOjha666/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-07T11:57:18Z",
        "updated_at": "2022-04-07T11:57:18Z",
        "author_association": "NONE",
        "body": "@tianleiwu Using optimized_model.convert_float_to_float16(use_symbolic_shape_infer=False, keep_io_types=False) the model has been converted sucessfully to fp16 and is producing no issues. But might effect accuracy a bit like you mentioned. Hence please let me know if there is a way to perform conversion in the way you suggested.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1091645944/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1100884201",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11119#issuecomment-1100884201",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11119",
        "id": 1100884201,
        "node_id": "IC_kwDOCVq1mM5Bnijp",
        "user": {
            "login": "VikasOjha666",
            "id": 35727142,
            "node_id": "MDQ6VXNlcjM1NzI3MTQy",
            "avatar_url": "https://avatars.githubusercontent.com/u/35727142?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/VikasOjha666",
            "html_url": "https://github.com/VikasOjha666",
            "followers_url": "https://api.github.com/users/VikasOjha666/followers",
            "following_url": "https://api.github.com/users/VikasOjha666/following{/other_user}",
            "gists_url": "https://api.github.com/users/VikasOjha666/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/VikasOjha666/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/VikasOjha666/subscriptions",
            "organizations_url": "https://api.github.com/users/VikasOjha666/orgs",
            "repos_url": "https://api.github.com/users/VikasOjha666/repos",
            "events_url": "https://api.github.com/users/VikasOjha666/events{/privacy}",
            "received_events_url": "https://api.github.com/users/VikasOjha666/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-17T14:04:49Z",
        "updated_at": "2022-04-17T14:04:49Z",
        "author_association": "NONE",
        "body": "@tianleiwu Could you please tell me how can I solve the above issue while converting the model with the above op_block_list?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1100884201/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1100893738",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11119#issuecomment-1100893738",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11119",
        "id": 1100893738,
        "node_id": "IC_kwDOCVq1mM5Bnk4q",
        "user": {
            "login": "VikasOjha666",
            "id": 35727142,
            "node_id": "MDQ6VXNlcjM1NzI3MTQy",
            "avatar_url": "https://avatars.githubusercontent.com/u/35727142?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/VikasOjha666",
            "html_url": "https://github.com/VikasOjha666",
            "followers_url": "https://api.github.com/users/VikasOjha666/followers",
            "following_url": "https://api.github.com/users/VikasOjha666/following{/other_user}",
            "gists_url": "https://api.github.com/users/VikasOjha666/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/VikasOjha666/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/VikasOjha666/subscriptions",
            "organizations_url": "https://api.github.com/users/VikasOjha666/orgs",
            "repos_url": "https://api.github.com/users/VikasOjha666/repos",
            "events_url": "https://api.github.com/users/VikasOjha666/events{/privacy}",
            "received_events_url": "https://api.github.com/users/VikasOjha666/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-17T14:47:26Z",
        "updated_at": "2022-04-17T20:14:52Z",
        "author_association": "NONE",
        "body": "@tianleiwu @wangyems @snnn  It loads with performing conversions using below script:\r\noptimized_model.convert_float_to_float16(use_symbolic_shape_infer=False, keep_io_types=False,op_block_list=['Pow','ReduceMean','Sqrt','Softmax','Relu']). Adding Add,Mul,Div to this list creates above issue.\r\n\r\nSince I am not a lot familiar with ONNX could you please help me out to sort this?.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1100893738/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1101590151",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11119#issuecomment-1101590151",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11119",
        "id": 1101590151,
        "node_id": "IC_kwDOCVq1mM5BqO6H",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-18T17:30:21Z",
        "updated_at": "2022-04-18T17:30:21Z",
        "author_association": "MEMBER",
        "body": "@VikasOjha666, \r\n\r\nAdd, Mu and Div might not impact the accuracy, they are optional to compute in float16. They might have slight performance boost since adding them could avoid some data Cast.\r\n\r\nWhen you compare fp32 graph to mixed graph, you can see that major difference is some Cast nodes (either from fp32 to fp16, or fp16 to fp32 data conversion) are added to the graph, and some weights are converted to fp16. The error means that one input of Add_73 is fp16 and another input is fp32, so the solution is to make both inputs to be same data type (by adding or removing a Cast node).\r\n\r\nYou can use Netron to open the graph to see which Cast node is missing or not needed to be added. Then change the conversion script (https://github.com/microsoft/onnxruntime/blob/master/onnxruntime/python/tools/transformers/float16.py) to resolve the issue. For example, add a post process to insert a Cast node, or remove a Cast node.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1101590151/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1101659198",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11119#issuecomment-1101659198",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11119",
        "id": 1101659198,
        "node_id": "IC_kwDOCVq1mM5Bqfw-",
        "user": {
            "login": "VikasOjha666",
            "id": 35727142,
            "node_id": "MDQ6VXNlcjM1NzI3MTQy",
            "avatar_url": "https://avatars.githubusercontent.com/u/35727142?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/VikasOjha666",
            "html_url": "https://github.com/VikasOjha666",
            "followers_url": "https://api.github.com/users/VikasOjha666/followers",
            "following_url": "https://api.github.com/users/VikasOjha666/following{/other_user}",
            "gists_url": "https://api.github.com/users/VikasOjha666/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/VikasOjha666/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/VikasOjha666/subscriptions",
            "organizations_url": "https://api.github.com/users/VikasOjha666/orgs",
            "repos_url": "https://api.github.com/users/VikasOjha666/repos",
            "events_url": "https://api.github.com/users/VikasOjha666/events{/privacy}",
            "received_events_url": "https://api.github.com/users/VikasOjha666/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-18T18:55:14Z",
        "updated_at": "2022-04-18T18:55:14Z",
        "author_association": "NONE",
        "body": "@tianleiwu Thanks for taking out time for answer the question.I will try this.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1101659198/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1101767698",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11119#issuecomment-1101767698",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11119",
        "id": 1101767698,
        "node_id": "IC_kwDOCVq1mM5Bq6QS",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-18T21:06:10Z",
        "updated_at": "2022-04-18T21:08:50Z",
        "author_association": "MEMBER",
        "body": "@VikasOjha666, I just drafted mixed precision conversion for T5 decoder, it seems working fine without problem. My python environment uses latest version of packages like the following:\r\n```\r\npytorch Version:1.11.0+cu113\r\ntransformers Version:4.18.0\r\nonnxruntime Version:1.11.0\r\n```\r\n\r\nIt is still in a branch, and you can try it like the following:\r\n```\r\ngit clone https://github.com/microsoft/onnxruntime\r\ncd onnxruntime/onnxruntime/python/tools/transformers/models/t5\r\ngit checkout tlwu/t5_auto_mixed_precision\r\npython convert_to_onnx.py -m t5-base -o --use_gpu -p fp16\r\n```\r\nThe mixed precision model is output as ./onnx_model/t5-base_decoder_fp16.onnx\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1101767698/reactions",
            "total_count": 2,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 2,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1101782139",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11119#issuecomment-1101782139",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11119",
        "id": 1101782139,
        "node_id": "IC_kwDOCVq1mM5Bq9x7",
        "user": {
            "login": "VikasOjha666",
            "id": 35727142,
            "node_id": "MDQ6VXNlcjM1NzI3MTQy",
            "avatar_url": "https://avatars.githubusercontent.com/u/35727142?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/VikasOjha666",
            "html_url": "https://github.com/VikasOjha666",
            "followers_url": "https://api.github.com/users/VikasOjha666/followers",
            "following_url": "https://api.github.com/users/VikasOjha666/following{/other_user}",
            "gists_url": "https://api.github.com/users/VikasOjha666/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/VikasOjha666/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/VikasOjha666/subscriptions",
            "organizations_url": "https://api.github.com/users/VikasOjha666/orgs",
            "repos_url": "https://api.github.com/users/VikasOjha666/repos",
            "events_url": "https://api.github.com/users/VikasOjha666/events{/privacy}",
            "received_events_url": "https://api.github.com/users/VikasOjha666/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-18T21:26:39Z",
        "updated_at": "2022-04-18T21:27:19Z",
        "author_association": "NONE",
        "body": "@tianleiwu . Thanks for the contribution it means a lot.Is it fast for longer sequences too?.And is it's accuracy good?. I mean no disrespect but I am just clearing my doubts as I am sticking on the same problem since past month. As the model I optimized last time was faster for large sequences but was same as torch model for longer sequences even with IO bindings. Then I followed the same with decoder utilizing past_key_values taking idea from a previous thread of yours. This model was fast even for larger sequences but had accuracy issues as I converted all the nodes in the decoder to float16.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1101782139/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1103268064",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11119#issuecomment-1103268064",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11119",
        "id": 1103268064,
        "node_id": "IC_kwDOCVq1mM5Bwojg",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-19T23:49:48Z",
        "updated_at": "2022-04-20T18:24:57Z",
        "author_association": "MEMBER",
        "body": "@VikasOjha666, \r\nBased on my previous experience on GPT-2, converting decoder to pure float16 will lead to accuracy issue, and mixed precision is the recommended solution to trade off performance and accuracy.\r\n\r\nOf course, it need some experiment to see the performance/accuracy impact when converting some operators to FP16/FP32. For example, we have a tool for GPT-2: https://github.com/microsoft/onnxruntime/blob/master/onnxruntime/python/tools/transformers/models/gpt2/gpt2_parity.py\r\nWe have not started similar tuning work on T5.\r\n\r\nTip: using float16 for past state (make sure past_key_values  inputs and present outputs are in float16) bring most performance gain, and MatMul (and Attention) computed in fp16 has slight performance gain. You can make these two in float16, and all others in float32 as one candidate of mixed precision. I think this candidate could achieve performance gain compared to float32 model and minimal accuracy loss for mixed precision. (2) put more operators to compute in float32 if you need higher accuracy.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1103268064/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1103921096",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11119#issuecomment-1103921096",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11119",
        "id": 1103921096,
        "node_id": "IC_kwDOCVq1mM5BzH_I",
        "user": {
            "login": "VikasOjha666",
            "id": 35727142,
            "node_id": "MDQ6VXNlcjM1NzI3MTQy",
            "avatar_url": "https://avatars.githubusercontent.com/u/35727142?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/VikasOjha666",
            "html_url": "https://github.com/VikasOjha666",
            "followers_url": "https://api.github.com/users/VikasOjha666/followers",
            "following_url": "https://api.github.com/users/VikasOjha666/following{/other_user}",
            "gists_url": "https://api.github.com/users/VikasOjha666/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/VikasOjha666/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/VikasOjha666/subscriptions",
            "organizations_url": "https://api.github.com/users/VikasOjha666/orgs",
            "repos_url": "https://api.github.com/users/VikasOjha666/repos",
            "events_url": "https://api.github.com/users/VikasOjha666/events{/privacy}",
            "received_events_url": "https://api.github.com/users/VikasOjha666/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-04-20T13:16:59Z",
        "updated_at": "2022-04-20T13:16:59Z",
        "author_association": "NONE",
        "body": "Thanks for the tip @tianleiwu will try it and let you know the results.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1103921096/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]