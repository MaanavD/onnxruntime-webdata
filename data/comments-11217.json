[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1120483874",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11217#issuecomment-1120483874",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11217",
        "id": 1120483874,
        "node_id": "IC_kwDOCVq1mM5CyToi",
        "user": {
            "login": "jdluzen",
            "id": 160958,
            "node_id": "MDQ6VXNlcjE2MDk1OA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/160958?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jdluzen",
            "html_url": "https://github.com/jdluzen",
            "followers_url": "https://api.github.com/users/jdluzen/followers",
            "following_url": "https://api.github.com/users/jdluzen/following{/other_user}",
            "gists_url": "https://api.github.com/users/jdluzen/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jdluzen/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jdluzen/subscriptions",
            "organizations_url": "https://api.github.com/users/jdluzen/orgs",
            "repos_url": "https://api.github.com/users/jdluzen/repos",
            "events_url": "https://api.github.com/users/jdluzen/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jdluzen/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-05-08T20:42:08Z",
        "updated_at": "2022-05-08T20:42:08Z",
        "author_association": "NONE",
        "body": "When I try to load this model in with the C# wrapper on Win10 x64, I get this:\r\n`Microsoft.ML.OnnxRuntime.OnnxRuntimeException: '[ErrorCode:RuntimeException] Exception during initialization: D:\\a\\_work\\1\\s\\onnxruntime\\core\\graph\\function.cc:462 onnxruntime::FunctionImpl::FunctionImpl status.IsOK() was false. This is an invalid model. Error: two nodes with same node name (Unsqueeze_1122).'`\r\nMaybe that is related to the root cause.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1120483874/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1121342938",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11217#issuecomment-1121342938",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11217",
        "id": 1121342938,
        "node_id": "IC_kwDOCVq1mM5C1lXa",
        "user": {
            "login": "josephrocca",
            "id": 1167575,
            "node_id": "MDQ6VXNlcjExNjc1NzU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1167575?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/josephrocca",
            "html_url": "https://github.com/josephrocca",
            "followers_url": "https://api.github.com/users/josephrocca/followers",
            "following_url": "https://api.github.com/users/josephrocca/following{/other_user}",
            "gists_url": "https://api.github.com/users/josephrocca/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/josephrocca/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/josephrocca/subscriptions",
            "organizations_url": "https://api.github.com/users/josephrocca/orgs",
            "repos_url": "https://api.github.com/users/josephrocca/repos",
            "events_url": "https://api.github.com/users/josephrocca/events{/privacy}",
            "received_events_url": "https://api.github.com/users/josephrocca/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-05-09T16:53:34Z",
        "updated_at": "2022-05-09T16:53:34Z",
        "author_association": "CONTRIBUTOR",
        "body": "@jdluzen Hmm that's weird - from what I can see it doesn't appear to be an invalid file. It loads correctly and [works fine](https://josephrocca.github.io/super-resolution-js/) with the web runtime and on https://netron.app\r\n\r\nSearching for `Unsqueeze_1122` on Netron only gives one search result:\r\n\r\n![image](https://user-images.githubusercontent.com/1167575/167458554-08e894b1-224f-4e1c-9e20-7044a51e6856.png)\r\n\r\nNote that it also takes a very long time to render in Netron due to the large node count. Netron says that there are about 28k nodes (I'll update the first post to mention this).\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1121342938/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1176340783",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11217#issuecomment-1176340783",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11217",
        "id": 1176340783,
        "node_id": "IC_kwDOCVq1mM5GHYkv",
        "user": {
            "login": "PINTO0309",
            "id": 33194443,
            "node_id": "MDQ6VXNlcjMzMTk0NDQz",
            "avatar_url": "https://avatars.githubusercontent.com/u/33194443?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/PINTO0309",
            "html_url": "https://github.com/PINTO0309",
            "followers_url": "https://api.github.com/users/PINTO0309/followers",
            "following_url": "https://api.github.com/users/PINTO0309/following{/other_user}",
            "gists_url": "https://api.github.com/users/PINTO0309/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/PINTO0309/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/PINTO0309/subscriptions",
            "organizations_url": "https://api.github.com/users/PINTO0309/orgs",
            "repos_url": "https://api.github.com/users/PINTO0309/repos",
            "events_url": "https://api.github.com/users/PINTO0309/events{/privacy}",
            "received_events_url": "https://api.github.com/users/PINTO0309/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-06T15:08:21Z",
        "updated_at": "2022-07-06T15:19:54Z",
        "author_association": "NONE",
        "body": "There are 41,085 OPs.\r\n```\r\n$ ssc4onnx --input_onnx_file_path 003_realSR_BSRGAN_DFO_s64w8_SwinIR-M_x4_GAN.onnx\r\n┏━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┓\r\n┃ OP Type                ┃ OPs        ┃\r\n┡━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━┩\r\n│ Add                    │ 1452       │\r\n│ Cast                   │ 1982       │\r\n│ Concat                 │ 1277       │\r\n│ Constant               │ 13284      │\r\n│ ConstantOfShape        │ 1657       │\r\n│ Conv                   │ 13         │\r\n│ Div                    │ 403        │\r\n│ Equal                  │ 1368       │\r\n│ Erf                    │ 36         │\r\n│ Expand                 │ 1620       │\r\n│ Gather                 │ 1922       │\r\n│ LeakyRelu              │ 4          │\r\n│ MatMul                 │ 216        │\r\n│ Mul                    │ 1521       │\r\n│ Not                    │ 36         │\r\n│ Pad                    │ 1          │\r\n│ Pow                    │ 74         │\r\n│ Range                  │ 1296       │\r\n│ ReduceMean             │ 148        │\r\n│ Reshape                │ 1852       │\r\n│ Resize                 │ 2          │\r\n│ ScatterND              │ 324        │\r\n│ Shape                  │ 4413       │\r\n│ Slice                  │ 1558       │\r\n│ Softmax                │ 36         │\r\n│ Sqrt                   │ 74         │\r\n│ Sub                    │ 118        │\r\n│ Transpose              │ 231        │\r\n│ Unsqueeze              │ 2799       │\r\n│ Where                  │ 1368       │\r\n│ ---------------------- │ ---------- │\r\n│ Total number of OPs    │ 41085      │\r\n│ ====================== │ ========== │\r\n│ Model Size             │ 58.5MiB    │\r\n└────────────────────────┴────────────┘\r\nINFO: file: 003_realSR_BSRGAN_DFO_s64w8_SwinIR-M_x4_GAN.onnx\r\nINFO: producer: pytorch 1.10\r\nINFO: opset: 12\r\nINFO: input_name.1: input shape: [1, 3, 'h', 'w'] dtype: float32\r\nINFO: output_name.1: output shape: ['Sliceoutput_dim_0', 'Sliceoutput_dim_1', 'h', 'w'] dtype: float32\r\nINFO: Finish!\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1176340783/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1176428758",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11217#issuecomment-1176428758",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11217",
        "id": 1176428758,
        "node_id": "IC_kwDOCVq1mM5GHuDW",
        "user": {
            "login": "josephrocca",
            "id": 1167575,
            "node_id": "MDQ6VXNlcjExNjc1NzU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1167575?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/josephrocca",
            "html_url": "https://github.com/josephrocca",
            "followers_url": "https://api.github.com/users/josephrocca/followers",
            "following_url": "https://api.github.com/users/josephrocca/following{/other_user}",
            "gists_url": "https://api.github.com/users/josephrocca/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/josephrocca/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/josephrocca/subscriptions",
            "organizations_url": "https://api.github.com/users/josephrocca/orgs",
            "repos_url": "https://api.github.com/users/josephrocca/repos",
            "events_url": "https://api.github.com/users/josephrocca/events{/privacy}",
            "received_events_url": "https://api.github.com/users/josephrocca/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-06T16:26:30Z",
        "updated_at": "2022-07-06T16:31:14Z",
        "author_association": "CONTRIBUTOR",
        "body": "Thanks @PINTO0309! I've just done a few tests of load/init times for different runtimes:\r\n\r\n* [Original Pytorch model](https://github.com/JingyunLiang/SwinIR/releases/download/v0.0/003_realSR_BSRGAN_DFO_s64w8_SwinIR-M_x4_GAN.pth) loaded [with Pytorch](https://colab.research.google.com/gist/josephrocca/ea5c04bf6da48f54659388fd65e899bb/swinir-demo-on-real-world-image-sr.ipynb): ~1 second\r\n* [ONNX file](https://huggingface.co/rocca/swin-ir-onnx/resolve/main/003_realSR_BSRGAN_DFO_s64w8_SwinIR-M_x4_GAN.onnx) loaded [with ORT Pytorch](https://colab.research.google.com/gist/josephrocca/d7c89dd54c7580e1faf1f1f982f9213a/swinit-40k-nodes-in-model-init-time-test.ipynb): ~40 seconds\r\n* [ONNX file](https://huggingface.co/rocca/swin-ir-onnx/resolve/main/003_realSR_BSRGAN_DFO_s64w8_SwinIR-M_x4_GAN.onnx) loaded [with ORT Web](https://josephrocca.github.io/super-resolution-js/): ~60 seconds (excluding model download time)\r\n\r\nI wonder if this is a useful test case for finding bottlenecks in the init? Given that Pytorch handles the init much quicker, and given that [SwinIR](https://github.com/JingyunLiang/SwinIR/) is a fairly popular model, it seems like it's worth looking into? **Edit:** But I guess it could also be a \"problem\" with the conversion - ops getting inefficiently converted into many ops, or something?\r\n\r\nNot sure who to ping here, or if it's appropriate to ping, so apologies if not! @snnn @edgchen1\r\n\r\n\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1176428758/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1176438485",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11217#issuecomment-1176438485",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11217",
        "id": 1176438485,
        "node_id": "IC_kwDOCVq1mM5GHwbV",
        "user": {
            "login": "PINTO0309",
            "id": 33194443,
            "node_id": "MDQ6VXNlcjMzMTk0NDQz",
            "avatar_url": "https://avatars.githubusercontent.com/u/33194443?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/PINTO0309",
            "html_url": "https://github.com/PINTO0309",
            "followers_url": "https://api.github.com/users/PINTO0309/followers",
            "following_url": "https://api.github.com/users/PINTO0309/following{/other_user}",
            "gists_url": "https://api.github.com/users/PINTO0309/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/PINTO0309/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/PINTO0309/subscriptions",
            "organizations_url": "https://api.github.com/users/PINTO0309/orgs",
            "repos_url": "https://api.github.com/users/PINTO0309/repos",
            "events_url": "https://api.github.com/users/PINTO0309/events{/privacy}",
            "received_events_url": "https://api.github.com/users/PINTO0309/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-06T16:36:51Z",
        "updated_at": "2022-07-06T16:36:51Z",
        "author_association": "NONE",
        "body": "The input size is not fixed and therefore not fully optimized.\r\n\r\nIt is also true that even with optimization, loading protocolbuffers into onnxruntime is several times slower than in Pytorch.\r\n\r\nIf it were me, I would use Torchscript. \r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1176438485/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]