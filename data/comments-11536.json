[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1129326404",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11536#issuecomment-1129326404",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11536",
        "id": 1129326404,
        "node_id": "IC_kwDOCVq1mM5DUCdE",
        "user": {
            "login": "hariharans29",
            "id": 9969784,
            "node_id": "MDQ6VXNlcjk5Njk3ODQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/9969784?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/hariharans29",
            "html_url": "https://github.com/hariharans29",
            "followers_url": "https://api.github.com/users/hariharans29/followers",
            "following_url": "https://api.github.com/users/hariharans29/following{/other_user}",
            "gists_url": "https://api.github.com/users/hariharans29/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/hariharans29/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/hariharans29/subscriptions",
            "organizations_url": "https://api.github.com/users/hariharans29/orgs",
            "repos_url": "https://api.github.com/users/hariharans29/repos",
            "events_url": "https://api.github.com/users/hariharans29/events{/privacy}",
            "received_events_url": "https://api.github.com/users/hariharans29/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-05-17T21:17:49Z",
        "updated_at": "2022-05-17T21:17:49Z",
        "author_association": "MEMBER",
        "body": "Is it similar to this: https://github.com/microsoft/onnxruntime/issues/5991 ?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1129326404/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1129367702",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11536#issuecomment-1129367702",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11536",
        "id": 1129367702,
        "node_id": "IC_kwDOCVq1mM5DUMiW",
        "user": {
            "login": "xadupre",
            "id": 22452781,
            "node_id": "MDQ6VXNlcjIyNDUyNzgx",
            "avatar_url": "https://avatars.githubusercontent.com/u/22452781?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/xadupre",
            "html_url": "https://github.com/xadupre",
            "followers_url": "https://api.github.com/users/xadupre/followers",
            "following_url": "https://api.github.com/users/xadupre/following{/other_user}",
            "gists_url": "https://api.github.com/users/xadupre/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/xadupre/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/xadupre/subscriptions",
            "organizations_url": "https://api.github.com/users/xadupre/orgs",
            "repos_url": "https://api.github.com/users/xadupre/repos",
            "events_url": "https://api.github.com/users/xadupre/events{/privacy}",
            "received_events_url": "https://api.github.com/users/xadupre/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-05-17T22:15:01Z",
        "updated_at": "2022-05-17T22:15:01Z",
        "author_association": "MEMBER",
        "body": "That seems the same. It seems something consistent with onnx. The error message is not very helping in understanding the cause. Maybe we could add a more explicit one.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1129367702/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1129601109",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11536#issuecomment-1129601109",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11536",
        "id": 1129601109,
        "node_id": "IC_kwDOCVq1mM5DVFhV",
        "user": {
            "login": "skottmckay",
            "id": 979079,
            "node_id": "MDQ6VXNlcjk3OTA3OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/979079?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/skottmckay",
            "html_url": "https://github.com/skottmckay",
            "followers_url": "https://api.github.com/users/skottmckay/followers",
            "following_url": "https://api.github.com/users/skottmckay/following{/other_user}",
            "gists_url": "https://api.github.com/users/skottmckay/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/skottmckay/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/skottmckay/subscriptions",
            "organizations_url": "https://api.github.com/users/skottmckay/orgs",
            "repos_url": "https://api.github.com/users/skottmckay/repos",
            "events_url": "https://api.github.com/users/skottmckay/events{/privacy}",
            "received_events_url": "https://api.github.com/users/skottmckay/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-05-18T05:59:40Z",
        "updated_at": "2022-05-18T05:59:40Z",
        "author_association": "MEMBER",
        "body": "The problem is that an outer scope value is being directly returned by a subgraph and the ORT code doesn't allow for that when creating the Graph instance (it expects all outputs to be created within the subgraph). It's not until later that we build all the connections to validate outer scope value usage.\r\n\r\nIn theory we can check if the value exists in an ancestor graph and allow it, however we would need to create a NodeArg in the subgraph for the value. This is consistent with how other outer scope values are treated and maintains a condition that there's a NodeArg for all values in the Graph, be they local or outer scope.\r\n\r\ne.g.\r\nhttps://github.com/microsoft/onnxruntime/blob/48efeca66cbc7eada72a0c59a87476a75b36aa14/onnxruntime/core/graph/graph.cc#L1199\r\n\r\nAll good in theory, but next would be that the BuildConnections logic is not aware of an outer scope value directly providing a subgraph output. Cuurently that means the outer scope value doesn't make it into the implicit inputs for the subgraph, and type/shape inferencing wouldn't be aware of it. The current logic only does this resolution for node inputs:\r\n\r\nhttps://github.com/microsoft/onnxruntime/blob/48efeca66cbc7eada72a0c59a87476a75b36aa14/onnxruntime/core/graph/graph.cc#L1647-L1658\r\n\r\nWe could add another step to BuildConnections for this, but there may also be allocation planning issues with this sort of setup (haven't looked into that). \r\n\r\nThe question at this point is whether it's worth all this complexity for an edge case that the ONNX spec doesn't clearly state is allowed. The only relevant statement I could find was in the [Loop spec](https://github.com/onnx/onnx/blob/main/docs/Operators.md#Loop), where it says\r\n\r\n> Values from the enclosing scope (i.e. variable \"a\" here) are in scope and can be referenced in the inputs of the loop.\r\n\r\nIt does not say anything about an outer scope value being able to be directly returned as a subgraph output.\r\n\r\nGiven all that, I think it's easier to require an Identity node to pass through an outer scope value as a subgraph output. \r\n\r\nSide note: Looking at the model it may be possible to use a Where node instead of an If given the subgraphs are simply choosing a value and not doing any other processing.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1129601109/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1129715289",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11536#issuecomment-1129715289",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11536",
        "id": 1129715289,
        "node_id": "IC_kwDOCVq1mM5DVhZZ",
        "user": {
            "login": "xadupre",
            "id": 22452781,
            "node_id": "MDQ6VXNlcjIyNDUyNzgx",
            "avatar_url": "https://avatars.githubusercontent.com/u/22452781?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/xadupre",
            "html_url": "https://github.com/xadupre",
            "followers_url": "https://api.github.com/users/xadupre/followers",
            "following_url": "https://api.github.com/users/xadupre/following{/other_user}",
            "gists_url": "https://api.github.com/users/xadupre/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/xadupre/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/xadupre/subscriptions",
            "organizations_url": "https://api.github.com/users/xadupre/orgs",
            "repos_url": "https://api.github.com/users/xadupre/repos",
            "events_url": "https://api.github.com/users/xadupre/events{/privacy}",
            "received_events_url": "https://api.github.com/users/xadupre/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-05-18T08:21:02Z",
        "updated_at": "2022-05-18T13:52:58Z",
        "author_association": "MEMBER",
        "body": "Can we display a better error message if this case happens? In that specific, If cannot be replaced by Where because then branch and else branch return arrays with different sizes.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1129715289/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]