[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1148382165",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11759#issuecomment-1148382165",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11759",
        "id": 1148382165,
        "node_id": "IC_kwDOCVq1mM5EcuvV",
        "user": {
            "login": "developerChans",
            "id": 68864422,
            "node_id": "MDQ6VXNlcjY4ODY0NDIy",
            "avatar_url": "https://avatars.githubusercontent.com/u/68864422?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/developerChans",
            "html_url": "https://github.com/developerChans",
            "followers_url": "https://api.github.com/users/developerChans/followers",
            "following_url": "https://api.github.com/users/developerChans/following{/other_user}",
            "gists_url": "https://api.github.com/users/developerChans/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/developerChans/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/developerChans/subscriptions",
            "organizations_url": "https://api.github.com/users/developerChans/orgs",
            "repos_url": "https://api.github.com/users/developerChans/repos",
            "events_url": "https://api.github.com/users/developerChans/events{/privacy}",
            "received_events_url": "https://api.github.com/users/developerChans/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-07T08:48:20Z",
        "updated_at": "2022-06-07T08:48:20Z",
        "author_association": "NONE",
        "body": "[add_dataset.zip](https://github.com/microsoft/onnxruntime/files/8851646/add_dataset.zip)\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1148382165/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1150165773",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11759#issuecomment-1150165773",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11759",
        "id": 1150165773,
        "node_id": "IC_kwDOCVq1mM5EjiMN",
        "user": {
            "login": "yufenglee",
            "id": 30486710,
            "node_id": "MDQ6VXNlcjMwNDg2NzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/30486710?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufenglee",
            "html_url": "https://github.com/yufenglee",
            "followers_url": "https://api.github.com/users/yufenglee/followers",
            "following_url": "https://api.github.com/users/yufenglee/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufenglee/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufenglee/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufenglee/subscriptions",
            "organizations_url": "https://api.github.com/users/yufenglee/orgs",
            "repos_url": "https://api.github.com/users/yufenglee/repos",
            "events_url": "https://api.github.com/users/yufenglee/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufenglee/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-08T16:58:38Z",
        "updated_at": "2022-06-08T16:58:38Z",
        "author_association": "MEMBER",
        "body": "@developerChans, QLinearAdd on x86 uses 'round to nearest, ties to even' but uses 'round to nearest, ties to up' on arm. As you tested on the x86, I think the numeric difference (98.50000716 in our c program vs 98.5 in ORT) comes from the computation order. We compute the fixed part firstly. Here is how QLinearAdd computed in ORT. Could you please alternate your C program in same computing order and see if you can get same result?\r\n\r\nhttps://github.com/microsoft/onnxruntime/blob/62551946593382489b1f3dc4187adc0838ed472b/onnxruntime/core/mlas/lib/intrinsics/avx2/qladd_avx2.cpp#L116",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1150165773/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1150645993",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11759#issuecomment-1150645993",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11759",
        "id": 1150645993,
        "node_id": "IC_kwDOCVq1mM5ElXbp",
        "user": {
            "login": "developerChans",
            "id": 68864422,
            "node_id": "MDQ6VXNlcjY4ODY0NDIy",
            "avatar_url": "https://avatars.githubusercontent.com/u/68864422?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/developerChans",
            "html_url": "https://github.com/developerChans",
            "followers_url": "https://api.github.com/users/developerChans/followers",
            "following_url": "https://api.github.com/users/developerChans/following{/other_user}",
            "gists_url": "https://api.github.com/users/developerChans/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/developerChans/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/developerChans/subscriptions",
            "organizations_url": "https://api.github.com/users/developerChans/orgs",
            "repos_url": "https://api.github.com/users/developerChans/repos",
            "events_url": "https://api.github.com/users/developerChans/events{/privacy}",
            "received_events_url": "https://api.github.com/users/developerChans/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-09T04:07:54Z",
        "updated_at": "2022-06-09T06:14:23Z",
        "author_association": "NONE",
        "body": "Before fixed C code\r\n\r\n```\r\n#define roundNum(x) ((x) >= 0 ? (float32_t)((x) + 0.5):(float32_t)((x) - 0.5))\r\n\r\nint QlinearAdd(...) {\r\n            ...\r\n            ...\r\n            int32_t temp;\r\n            int32_t A_value = A[A_index] - A_zeropoint;\r\n            int32_t B_value = B[B_index] - B_zeropoint;\r\n            temp = roundNum((A_scale * A_value + B_scale * B_value) / C_scale);\r\n            if(temp + (int32_t)c_zero_point >= TYPE_MAX) {\r\n                temp = TYPE_MAX;\r\n            }\r\n            else if(temp + (int32_t)c_zero_point <= DTYPE_MIN) {\r\n                temp = TYPE_MIN;\r\n            } else {\r\n                temp = temp + (int32_t)c_zero_point;\r\n            }\r\n            C[C_index] = (TYPE)temp;\r\n}\r\n```\r\n\r\n\r\nAfter  fixed C code\r\n\r\nIn addition to the existing accuracy problems, problems arose with other results.\r\n\r\nThe number of different 98(99) results that occurred before was 20 out of 75264.\r\n\r\nHowever, if you change it like the suggested method, it was 100 out of 75264.\r\n\r\n![image](https://user-images.githubusercontent.com/68864422/172761700-70d28211-d504-4879-bc8e-2e36a1c2d14c.png)\r\n\r\n```\r\n#define roundNum(x) ((x) >= 0 ? (float32_t)((x) + 0.5):(float32_t)((x) - 0.5))\r\nint QlinearAdd(...) {\r\n            ...\r\n            ...\r\n            int32_t temp;\r\n            float32_t fixed_scale_A = A_scale/ C_scale;\r\n            float32_t fixed_scale_B= B_scale / C_scale;\r\n            float32_t vector_fixed_part = (float32_t)C_zeropoint - (fixed_scale_A * A_zeropoint + fixed_scale_B * B_zeropoint);\r\n\r\n            float32_t temp1 = (float32_t)(A[A_index] * fixed_scale_A ) + (float32_t)(B[B_index] * fixed_scale_B ) + vector_fixed_part;\r\n            if(temp1 >= (float32_t)TYPE_MAX) {\r\n                temp = TYPE_MAX;\r\n            }\r\n            else if(temp1 <= (float32_t)TYPE_MIN) {\r\n                temp = TYPE_MIN;\r\n            } else {\r\n                temp = roundNum(temp1);\r\n            }\r\n            C[C_index] = (TYPE)temp;\r\n}\r\n```\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1150645993/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1150654154",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11759#issuecomment-1150654154",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11759",
        "id": 1150654154,
        "node_id": "IC_kwDOCVq1mM5ElZbK",
        "user": {
            "login": "yufenglee",
            "id": 30486710,
            "node_id": "MDQ6VXNlcjMwNDg2NzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/30486710?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufenglee",
            "html_url": "https://github.com/yufenglee",
            "followers_url": "https://api.github.com/users/yufenglee/followers",
            "following_url": "https://api.github.com/users/yufenglee/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufenglee/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufenglee/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufenglee/subscriptions",
            "organizations_url": "https://api.github.com/users/yufenglee/orgs",
            "repos_url": "https://api.github.com/users/yufenglee/repos",
            "events_url": "https://api.github.com/users/yufenglee/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufenglee/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-09T04:24:16Z",
        "updated_at": "2022-06-09T04:24:16Z",
        "author_association": "MEMBER",
        "body": "You roundNum implementation is not right. it actually round x.5 up, not to even. Please use this function:\r\nhttps://en.cppreference.com/w/c/numeric/math/nearbyint ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1150654154/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1150761732",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11759#issuecomment-1150761732",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11759",
        "id": 1150761732,
        "node_id": "IC_kwDOCVq1mM5ElzsE",
        "user": {
            "login": "developerChans",
            "id": 68864422,
            "node_id": "MDQ6VXNlcjY4ODY0NDIy",
            "avatar_url": "https://avatars.githubusercontent.com/u/68864422?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/developerChans",
            "html_url": "https://github.com/developerChans",
            "followers_url": "https://api.github.com/users/developerChans/followers",
            "following_url": "https://api.github.com/users/developerChans/following{/other_user}",
            "gists_url": "https://api.github.com/users/developerChans/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/developerChans/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/developerChans/subscriptions",
            "organizations_url": "https://api.github.com/users/developerChans/orgs",
            "repos_url": "https://api.github.com/users/developerChans/repos",
            "events_url": "https://api.github.com/users/developerChans/events{/privacy}",
            "received_events_url": "https://api.github.com/users/developerChans/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-09T07:18:35Z",
        "updated_at": "2022-06-09T07:24:49Z",
        "author_association": "NONE",
        "body": "Edited by referring to the link.\r\n\r\nExisting accuracy problems have been resolved.\r\n\r\nHowever, new problems arose in the new part.\r\n\r\nThis part is also 137.499992... If you follow the round rule of onnx_runtime, it should be 138, but the result of onnx_runtime is 137.\r\n\r\nOnly 5 out of the total of 75264 show different values, A and B values ​​are the same in all errors.\r\n\r\n![image](https://user-images.githubusercontent.com/68864422/172788352-a3bae4a9-20bf-4b14-9593-df76fc032ffb.png)\r\n\r\nI used nearbyIntf...\r\n\r\n```\r\n#include <math.h>\r\n#define roundNum(x) ((x) >= 0 ? (float32_t)((x) + 0.5):(float32_t)((x) - 0.5))\r\nint QlinearAdd(...) {\r\n            ...\r\n            ...\r\n            int32_t temp;\r\n            float32_t fixed_scale_A = A_scale/ C_scale;\r\n            float32_t fixed_scale_B= B_scale / C_scale;\r\n            float32_t vector_fixed_part = (float32_t)C_zeropoint - (fixed_scale_A * A_zeropoint + fixed_scale_B * B_zeropoint);\r\n\r\n            float32_t temp1 = (float32_t)(A[A_index] * fixed_scale_A ) + (float32_t)(B[B_index] * fixed_scale_B ) + vector_fixed_part;\r\n            if(temp1 >= (float32_t)TYPE_MAX) {\r\n                temp = TYPE_MAX;\r\n            }\r\n            else if(temp1 <= (float32_t)TYPE_MIN) {\r\n                temp = TYPE_MIN;\r\n            } else {\r\n                temp = nearbyintf(temp1);\r\n            }\r\n            C[C_index] = (TYPE)temp;\r\n}\r\n```\r\n\r\nThis is gcc terminal capture image...\r\n![image](https://user-images.githubusercontent.com/68864422/172788070-39a3cc03-c716-4e82-927c-53acbffccb36.png)\r\n\r\n\r\nHmm... Maybe the location to do nearbyint is wrong?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1150761732/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1151319534",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11759#issuecomment-1151319534",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11759",
        "id": 1151319534,
        "node_id": "IC_kwDOCVq1mM5En73u",
        "user": {
            "login": "yufenglee",
            "id": 30486710,
            "node_id": "MDQ6VXNlcjMwNDg2NzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/30486710?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yufenglee",
            "html_url": "https://github.com/yufenglee",
            "followers_url": "https://api.github.com/users/yufenglee/followers",
            "following_url": "https://api.github.com/users/yufenglee/following{/other_user}",
            "gists_url": "https://api.github.com/users/yufenglee/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yufenglee/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yufenglee/subscriptions",
            "organizations_url": "https://api.github.com/users/yufenglee/orgs",
            "repos_url": "https://api.github.com/users/yufenglee/repos",
            "events_url": "https://api.github.com/users/yufenglee/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yufenglee/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-09T15:58:45Z",
        "updated_at": "2022-06-09T15:58:45Z",
        "author_association": "MEMBER",
        "body": "137.499992 is less than 137.5 and should be rounded to 137. 137.5 will be rounded to 138, so OnnxRuntime's result is correct. \r\nPlease note that the rounding rule is \"round to nearest, ties to even\". for 137.499992, its nearest integer is 137, so it will be rounded to 137. For 137.5, its nearest integers are 137 and 138 (tie). Then round to even(138).",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1151319534/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1151854108",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11759#issuecomment-1151854108",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11759",
        "id": 1151854108,
        "node_id": "IC_kwDOCVq1mM5Ep-Yc",
        "user": {
            "login": "developerChans",
            "id": 68864422,
            "node_id": "MDQ6VXNlcjY4ODY0NDIy",
            "avatar_url": "https://avatars.githubusercontent.com/u/68864422?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/developerChans",
            "html_url": "https://github.com/developerChans",
            "followers_url": "https://api.github.com/users/developerChans/followers",
            "following_url": "https://api.github.com/users/developerChans/following{/other_user}",
            "gists_url": "https://api.github.com/users/developerChans/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/developerChans/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/developerChans/subscriptions",
            "organizations_url": "https://api.github.com/users/developerChans/orgs",
            "repos_url": "https://api.github.com/users/developerChans/repos",
            "events_url": "https://api.github.com/users/developerChans/events{/privacy}",
            "received_events_url": "https://api.github.com/users/developerChans/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-10T02:31:26Z",
        "updated_at": "2022-06-10T02:31:26Z",
        "author_association": "NONE",
        "body": "Thank you. @yufenglee  I solved the problem in the following way. First, the rounding rule was modified through nearbyintf, and finally, it was converted from calculating in 32-bit to calculating in 64-bit format. For decimal arithmetic, I think 64-bit arithmetic should be preferred.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1151854108/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]