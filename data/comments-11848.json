[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1157028109",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11848#issuecomment-1157028109",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11848",
        "id": 1157028109,
        "node_id": "IC_kwDOCVq1mM5E9tkN",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-15T22:58:32Z",
        "updated_at": "2022-06-15T23:00:01Z",
        "author_association": "MEMBER",
        "body": "I guess it is because external data. Previously, the encoder onnx and decoder onnx might be in different folder. \r\nAfter merging them into one ONNX model, now ORT start looking for the external data file in the same folder. If encoder and decoder have same external data filename. There will be confliction.\r\n\r\nThe solution is to make sure they use different files to store external data like:\r\n```\r\nmt5_encoder.onnx\r\nmt5_encoder.onnx.data (This is the external data file for encoder)\r\nmt5_decoder.onnx\r\nmt5_decoder.onnx.data (This is the external data file for decoder)\r\n```\r\n\r\nTo achieve that, we can use onnx API to save encoder/decoder ONNX model like\r\n```\r\nmodel=onnx.load_model(\"mt5_encoder.onnx\", load_externa_data=True)\r\nonnx.save_model(\"mt5_encoder.onnx\", save_as_external_data=True,  all_tensors_to_one_file=True, location=\"mt5_encoder.onnx.data\", size_threshold=1024, convert_attribute=False)\r\n```\r\n\r\nAfter that, you can run convert_beam_search.py if needed.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1157028109/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1157412165",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11848#issuecomment-1157412165",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11848",
        "id": 1157412165,
        "node_id": "IC_kwDOCVq1mM5E_LVF",
        "user": {
            "login": "OriAlpha",
            "id": 41699212,
            "node_id": "MDQ6VXNlcjQxNjk5MjEy",
            "avatar_url": "https://avatars.githubusercontent.com/u/41699212?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/OriAlpha",
            "html_url": "https://github.com/OriAlpha",
            "followers_url": "https://api.github.com/users/OriAlpha/followers",
            "following_url": "https://api.github.com/users/OriAlpha/following{/other_user}",
            "gists_url": "https://api.github.com/users/OriAlpha/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/OriAlpha/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/OriAlpha/subscriptions",
            "organizations_url": "https://api.github.com/users/OriAlpha/orgs",
            "repos_url": "https://api.github.com/users/OriAlpha/repos",
            "events_url": "https://api.github.com/users/OriAlpha/events{/privacy}",
            "received_events_url": "https://api.github.com/users/OriAlpha/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-16T09:00:03Z",
        "updated_at": "2022-06-16T09:05:32Z",
        "author_association": "NONE",
        "body": "I converted model as you specified, but still its gives out issue. \r\n`onnxruntime.capi.onnxruntime_pybind11_state.Fail: [ONNXRuntimeError] : 1 : FAIL : Deserialize tensor onnx::MatMul_4720 failed.tensorprotoutils.cc:145 GetExternalDataInfo TensorProto: onnx::MatMul_4720 external data size mismatch. Computed size: 4194304, external_data.length: 11534336\r\n`\r\nAdditional info decoder_init.onnx.data is around 3.5 GB. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1157412165/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1157875126",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11848#issuecomment-1157875126",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11848",
        "id": 1157875126,
        "node_id": "IC_kwDOCVq1mM5FA8W2",
        "user": {
            "login": "OriAlpha",
            "id": 41699212,
            "node_id": "MDQ6VXNlcjQxNjk5MjEy",
            "avatar_url": "https://avatars.githubusercontent.com/u/41699212?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/OriAlpha",
            "html_url": "https://github.com/OriAlpha",
            "followers_url": "https://api.github.com/users/OriAlpha/followers",
            "following_url": "https://api.github.com/users/OriAlpha/following{/other_user}",
            "gists_url": "https://api.github.com/users/OriAlpha/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/OriAlpha/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/OriAlpha/subscriptions",
            "organizations_url": "https://api.github.com/users/OriAlpha/orgs",
            "repos_url": "https://api.github.com/users/OriAlpha/repos",
            "events_url": "https://api.github.com/users/OriAlpha/events{/privacy}",
            "received_events_url": "https://api.github.com/users/OriAlpha/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-16T16:25:07Z",
        "updated_at": "2022-06-16T16:25:07Z",
        "author_association": "NONE",
        "body": "If you want to try model please use https://huggingface.co/google/mt5-large/tree/main",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1157875126/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1159280604",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11848#issuecomment-1159280604",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11848",
        "id": 1159280604,
        "node_id": "IC_kwDOCVq1mM5FGTfc",
        "user": {
            "login": "OriAlpha",
            "id": 41699212,
            "node_id": "MDQ6VXNlcjQxNjk5MjEy",
            "avatar_url": "https://avatars.githubusercontent.com/u/41699212?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/OriAlpha",
            "html_url": "https://github.com/OriAlpha",
            "followers_url": "https://api.github.com/users/OriAlpha/followers",
            "following_url": "https://api.github.com/users/OriAlpha/following{/other_user}",
            "gists_url": "https://api.github.com/users/OriAlpha/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/OriAlpha/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/OriAlpha/subscriptions",
            "organizations_url": "https://api.github.com/users/OriAlpha/orgs",
            "repos_url": "https://api.github.com/users/OriAlpha/repos",
            "events_url": "https://api.github.com/users/OriAlpha/events{/privacy}",
            "received_events_url": "https://api.github.com/users/OriAlpha/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-17T22:32:11Z",
        "updated_at": "2022-06-17T22:34:14Z",
        "author_association": "NONE",
        "body": "I even tried testing in different systems, still it give same issue as \r\n`onnxruntime.capi.onnxruntime_pybind11_state.Fail: [ONNXRuntimeError] : 1 : FAIL : Deserialize tensor onnx::MatMul_4498 failed.tensorprotoutils.cc:145 GetExternalDataInfo TensorProto external data size mismatch. Computed size: 11534336, external_data.length: 4194304` \r\nThis happens only for decoder module, encoder and decoder_init session creates without any issues. \r\n@tianleiwu do you suggest any way to fix these issues",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1159280604/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1163792561",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11848#issuecomment-1163792561",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11848",
        "id": 1163792561,
        "node_id": "IC_kwDOCVq1mM5FXhCx",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-23T00:17:43Z",
        "updated_at": "2022-06-23T00:17:43Z",
        "author_association": "MEMBER",
        "body": "@[OriAlpha](https://github.com/OriAlpha), you can try get the source of my pull request 11958 and run like the following for onnx conversion (need install nightly package or build wheel from source for model inference):\r\n```\r\npython convert_beam_search.py -m google/mt5-large --model_type mt5 --output mt5-large-beamsearch.onnx -e\r\n```\r\nI can run mt5_large model. There is still some parity issue (max diff are close to e-2) need PyTorch exporter team to take a look. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1163792561/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1164971266",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/11848#issuecomment-1164971266",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/11848",
        "id": 1164971266,
        "node_id": "IC_kwDOCVq1mM5FcA0C",
        "user": {
            "login": "OriAlpha",
            "id": 41699212,
            "node_id": "MDQ6VXNlcjQxNjk5MjEy",
            "avatar_url": "https://avatars.githubusercontent.com/u/41699212?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/OriAlpha",
            "html_url": "https://github.com/OriAlpha",
            "followers_url": "https://api.github.com/users/OriAlpha/followers",
            "following_url": "https://api.github.com/users/OriAlpha/following{/other_user}",
            "gists_url": "https://api.github.com/users/OriAlpha/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/OriAlpha/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/OriAlpha/subscriptions",
            "organizations_url": "https://api.github.com/users/OriAlpha/orgs",
            "repos_url": "https://api.github.com/users/OriAlpha/repos",
            "events_url": "https://api.github.com/users/OriAlpha/events{/privacy}",
            "received_events_url": "https://api.github.com/users/OriAlpha/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-23T22:22:19Z",
        "updated_at": "2022-06-23T22:22:19Z",
        "author_association": "NONE",
        "body": "Thanks for looking, its working. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/1164971266/reactions",
            "total_count": 2,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 1,
            "heart": 1,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]