[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/514322927",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/1467#issuecomment-514322927",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/1467",
        "id": 514322927,
        "node_id": "MDEyOklzc3VlQ29tbWVudDUxNDMyMjkyNw==",
        "user": {
            "login": "ke1337",
            "id": 22626095,
            "node_id": "MDQ6VXNlcjIyNjI2MDk1",
            "avatar_url": "https://avatars.githubusercontent.com/u/22626095?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ke1337",
            "html_url": "https://github.com/ke1337",
            "followers_url": "https://api.github.com/users/ke1337/followers",
            "following_url": "https://api.github.com/users/ke1337/following{/other_user}",
            "gists_url": "https://api.github.com/users/ke1337/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ke1337/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ke1337/subscriptions",
            "organizations_url": "https://api.github.com/users/ke1337/orgs",
            "repos_url": "https://api.github.com/users/ke1337/repos",
            "events_url": "https://api.github.com/users/ke1337/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ke1337/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-07-23T18:12:17Z",
        "updated_at": "2019-07-23T18:12:17Z",
        "author_association": "CONTRIBUTOR",
        "body": "The model has batch_size of 1 from Resnet50_Graph.txt:\r\n```\r\nname: \"input:0\"\r\ntype {\r\n  tensor_type {\r\n    elem_type: 1\r\n    shape {\r\n      dim {\r\n        dim_value: 1\r\n      }\r\n      dim {\r\n        dim_value: 224\r\n      }\r\n      dim {\r\n        dim_value: 224\r\n      }\r\n      dim {\r\n        dim_value: 3\r\n      }\r\n    }\r\n  }\r\n```\r\nBelow is the script I used to generate resnet50 model with batch, as well as random test data:\r\n```\r\nimport numpy as np\r\nimport os\r\nimport tarfile\r\nimport unittest\r\nimport urllib.request\r\nimport onnx\r\nfrom onnx import numpy_helper\r\nfrom onnx import shape_inference\r\n\r\n# download\r\ncwd = os.getcwd()\r\ndownload_url = 'https://s3.amazonaws.com/download.onnx/models/opset_9/resnet50.tar.gz'\r\ndownload_local = os.path.join(cwd, 'resnet50.tar.gz')\r\nif not os.path.exists(download_local):\r\n    urllib.request.urlretrieve(download_url, download_local)\r\n    with tarfile.open(download_local, 'r') as f:\r\n        f.extractall(cwd)\r\n\r\n# load model to edit\r\nmp = onnx.load(os.path.join(cwd, 'resnet50', 'model.onnx'))\r\ninput_name = 'gpu_0/data_0'\r\nbatch_symbol = 'batch'\r\ngraph_input = [i for i in mp.graph.input if i.name == input_name][0]\r\n# change input to have symbolic batch\r\ngraph_input.type.tensor_type.shape.dim[0].dim_param = batch_symbol\r\n# clear stale shape inference\r\nmp.graph.ClearField('value_info')\r\n# fix the reshape op that outputs OC2_DUMMY_0 to forward 'batch' using 0\r\nshape_const = [i for i in mp.graph.initializer if i.name == 'OC2_DUMMY_1'][0]\r\nshape_const.CopyFrom(numpy_helper.from_array(np.asarray([0,2048], dtype=np.int64), 'OC2_DUMMY_1'))\r\n# add batch to graph output shape\r\nmp.graph.output[0].type.tensor_type.shape.dim[0].dim_param = batch_symbol\r\n# run shape inference\r\nmp = shape_inference.infer_shapes(mp)\r\n# save model with batch\r\nonnx.save(mp, os.path.join(cwd, 'resnet50', 'model_batch.onnx'))\r\n\r\n# generate test data for batch == 32\r\ntest_data_dir = os.path.join(cwd, 'resnet50', 'test_data_set_32')\r\nos.makedirs(test_data_dir)\r\nonnx.save_tensor(numpy_helper.from_array(np.random.rand(32,3,224,224).astype(np.float32), input_name), os.path.join(test_data_dir, 'input_0.pb'))\r\n```\r\n\r\nI tested the model on an old SandyBridge CPU single threaded, and with mklml it's 68ms for batch=1, 2s for batch=32. Nuphar seems to have a bug with the model, other than alignment issue, so no test results. Not sure how you got your numbers...",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/514322927/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/514328613",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/1467#issuecomment-514328613",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/1467",
        "id": 514328613,
        "node_id": "MDEyOklzc3VlQ29tbWVudDUxNDMyODYxMw==",
        "user": {
            "login": "joyIntel",
            "id": 39498824,
            "node_id": "MDQ6VXNlcjM5NDk4ODI0",
            "avatar_url": "https://avatars.githubusercontent.com/u/39498824?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/joyIntel",
            "html_url": "https://github.com/joyIntel",
            "followers_url": "https://api.github.com/users/joyIntel/followers",
            "following_url": "https://api.github.com/users/joyIntel/following{/other_user}",
            "gists_url": "https://api.github.com/users/joyIntel/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/joyIntel/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/joyIntel/subscriptions",
            "organizations_url": "https://api.github.com/users/joyIntel/orgs",
            "repos_url": "https://api.github.com/users/joyIntel/repos",
            "events_url": "https://api.github.com/users/joyIntel/events{/privacy}",
            "received_events_url": "https://api.github.com/users/joyIntel/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-07-23T18:28:03Z",
        "updated_at": "2019-07-23T18:28:03Z",
        "author_association": "NONE",
        "body": "Are you getting ` Graph input with name ## is not associated with a node` error when you run the default resnet50 model availabe on amazonaws ??\r\n\r\nI am using a modified version of resnet50. I want to share it but GitHub is not allowing me to share that big file. Is there any other way to share ??\r\n\r\nYeah, you identified it correctly. Nuphar has issue with default resnet50. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/514328613/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/514377305",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/1467#issuecomment-514377305",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/1467",
        "id": 514377305,
        "node_id": "MDEyOklzc3VlQ29tbWVudDUxNDM3NzMwNQ==",
        "user": {
            "login": "joyIntel",
            "id": 39498824,
            "node_id": "MDQ6VXNlcjM5NDk4ODI0",
            "avatar_url": "https://avatars.githubusercontent.com/u/39498824?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/joyIntel",
            "html_url": "https://github.com/joyIntel",
            "followers_url": "https://api.github.com/users/joyIntel/followers",
            "following_url": "https://api.github.com/users/joyIntel/following{/other_user}",
            "gists_url": "https://api.github.com/users/joyIntel/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/joyIntel/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/joyIntel/subscriptions",
            "organizations_url": "https://api.github.com/users/joyIntel/orgs",
            "repos_url": "https://api.github.com/users/joyIntel/repos",
            "events_url": "https://api.github.com/users/joyIntel/events{/privacy}",
            "received_events_url": "https://api.github.com/users/joyIntel/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-07-23T20:46:43Z",
        "updated_at": "2019-07-23T20:46:43Z",
        "author_association": "NONE",
        "body": "I got the idea of changing batch size and also modified my model. I have collected new perf data for Nuphar EP. Now it is not stable, so I guess my query is resolved.\r\n\r\nBut yes, there is a new issue that Nuphar has an error for default Resnet50 model.\r\n\r\n\r\n\r\nResnet50 | Default | nuphar\r\n-- | --  | --\r\nBS1 | 17.67s  | 7.24s\r\nBS4 | 60.56s | 26.75s\r\nBS8 | 127.53s | 49.25s\r\nBS32 | 516s | 201.21s\r\n\r\n\r\n\r\n\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/514377305/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/514380832",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/1467#issuecomment-514380832",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/1467",
        "id": 514380832,
        "node_id": "MDEyOklzc3VlQ29tbWVudDUxNDM4MDgzMg==",
        "user": {
            "login": "ke1337",
            "id": 22626095,
            "node_id": "MDQ6VXNlcjIyNjI2MDk1",
            "avatar_url": "https://avatars.githubusercontent.com/u/22626095?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ke1337",
            "html_url": "https://github.com/ke1337",
            "followers_url": "https://api.github.com/users/ke1337/followers",
            "following_url": "https://api.github.com/users/ke1337/following{/other_user}",
            "gists_url": "https://api.github.com/users/ke1337/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ke1337/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ke1337/subscriptions",
            "organizations_url": "https://api.github.com/users/ke1337/orgs",
            "repos_url": "https://api.github.com/users/ke1337/repos",
            "events_url": "https://api.github.com/users/ke1337/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ke1337/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-07-23T20:56:48Z",
        "updated_at": "2019-07-23T20:56:48Z",
        "author_association": "CONTRIBUTOR",
        "body": "The Nuphar bug would be addressed in future PR update. We are in the progress to expand the test for Nuphar. Since CNN is not the current focus of Nuphar, this is unnoticed until recently.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/514380832/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]