[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/576080575",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2871#issuecomment-576080575",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2871",
        "id": 576080575,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU3NjA4MDU3NQ==",
        "user": {
            "login": "zealerww",
            "id": 13357975,
            "node_id": "MDQ6VXNlcjEzMzU3OTc1",
            "avatar_url": "https://avatars.githubusercontent.com/u/13357975?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/zealerww",
            "html_url": "https://github.com/zealerww",
            "followers_url": "https://api.github.com/users/zealerww/followers",
            "following_url": "https://api.github.com/users/zealerww/following{/other_user}",
            "gists_url": "https://api.github.com/users/zealerww/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/zealerww/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/zealerww/subscriptions",
            "organizations_url": "https://api.github.com/users/zealerww/orgs",
            "repos_url": "https://api.github.com/users/zealerww/repos",
            "events_url": "https://api.github.com/users/zealerww/events{/privacy}",
            "received_events_url": "https://api.github.com/users/zealerww/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-01-20T02:23:18Z",
        "updated_at": "2020-01-20T02:23:18Z",
        "author_association": "NONE",
        "body": "More:\r\nI test fp16 and int8 model in cpu (Intel(R) Xeon(R) CPU E5-2650 v4)\r\nf16 model converted using https://github.com/onnx/onnx-docker/blob/master/onnx-ecosystem/converter_scripts/float32_float16_onnx.ipynb\r\nint8 model converted using https://github.com/microsoft/onnxruntime/tree/master/onnxruntime/python/tools/quantization\r\n\r\n* fp32: time 1s; cpu usage 600%\r\n* fp16: time 1s; cpu usage 600%\r\n* int8: time 4s; cpu usage 100%\r\n\r\nIt seems that fp16 and int8 model has no improvement in cpu.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/576080575/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/576101900",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2871#issuecomment-576101900",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2871",
        "id": 576101900,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU3NjEwMTkwMA==",
        "user": {
            "login": "tracysh",
            "id": 42477615,
            "node_id": "MDQ6VXNlcjQyNDc3NjE1",
            "avatar_url": "https://avatars.githubusercontent.com/u/42477615?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tracysh",
            "html_url": "https://github.com/tracysh",
            "followers_url": "https://api.github.com/users/tracysh/followers",
            "following_url": "https://api.github.com/users/tracysh/following{/other_user}",
            "gists_url": "https://api.github.com/users/tracysh/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tracysh/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tracysh/subscriptions",
            "organizations_url": "https://api.github.com/users/tracysh/orgs",
            "repos_url": "https://api.github.com/users/tracysh/repos",
            "events_url": "https://api.github.com/users/tracysh/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tracysh/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-01-20T04:32:18Z",
        "updated_at": "2020-01-20T04:32:18Z",
        "author_association": "CONTRIBUTOR",
        "body": "The int8 GEMM in the last release was still single-threaded. A multi-threaded int8 GEMM was just turned on in master with PR#2844.\r\n\r\nFor the CPU, FP16 currently is handled by casting all operations to FP32. The GPU path does support FP16 natively.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/576101900/reactions",
            "total_count": 2,
            "+1": 2,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/581932602",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2871#issuecomment-581932602",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2871",
        "id": 581932602,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU4MTkzMjYwMg==",
        "user": {
            "login": "zealerww",
            "id": 13357975,
            "node_id": "MDQ6VXNlcjEzMzU3OTc1",
            "avatar_url": "https://avatars.githubusercontent.com/u/13357975?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/zealerww",
            "html_url": "https://github.com/zealerww",
            "followers_url": "https://api.github.com/users/zealerww/followers",
            "following_url": "https://api.github.com/users/zealerww/following{/other_user}",
            "gists_url": "https://api.github.com/users/zealerww/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/zealerww/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/zealerww/subscriptions",
            "organizations_url": "https://api.github.com/users/zealerww/orgs",
            "repos_url": "https://api.github.com/users/zealerww/repos",
            "events_url": "https://api.github.com/users/zealerww/events{/privacy}",
            "received_events_url": "https://api.github.com/users/zealerww/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-02-04T14:22:58Z",
        "updated_at": "2020-02-04T14:22:58Z",
        "author_association": "NONE",
        "body": "@tracysh \r\nI use the latest onnxruntime in master branch, but I also got similar result.\r\n\r\n* fp32 model: time 40ms; cpu usage 450%\r\n* int8 model: time 65ms; cpu usage  300%\r\n\r\nAlso cannot get performance improvement\r\n\r\nI use resnet50 model in https://github.com/microsoft/onnxruntime/tree/master/onnxruntime/python/tools/quantization/E2E_example_model\r\n\r\ntest code\r\n```\r\nimport numpy as np\r\nimport onnxruntime as rt\r\nimport time\r\n\r\nso = rt.SessionOptions()\r\nso.intra_op_num_threads = 4\r\nso.execution_mode = rt.ExecutionMode.ORT_SEQUENTIAL\r\nso.graph_optimization_level = rt.GraphOptimizationLevel.ORT_DISABLE_ALL\r\nsess = rt.InferenceSession('resnet50_int8.onnx', providers=['CPUExecutionProvider'], sess_options=so)\r\n\r\ninput_name = sess.get_inputs()[0].name\r\nimage = np.random.rand(1, 224, 224, 3).astype('float32')\r\n\r\nfor i in range(1000):\r\n    t1 = time.time()\r\n    output = sess.run(None, {input_name: image})\r\n    t2 = time.time()\r\n    print('time', t2 - t1)\r\n```\r\n\r\nquantization code\r\n```\r\nimport onnx\r\nfrom quantize import quantize, QuantizationMode\r\n\r\n# Load the onnx model\r\nmodel = onnx.load('resnet50_v1.onnx')\r\n# Quantize\r\nquantized_model = quantize(model, quantization_mode=QuantizationMode.IntegerOps, static=False)\r\n# Save the quantized model\r\nonnx.save(quantized_model, 'resnet50_int8.onnx')\r\n```\r\nAny idea?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/581932602/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/582065678",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2871#issuecomment-582065678",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2871",
        "id": 582065678,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU4MjA2NTY3OA==",
        "user": {
            "login": "tracysh",
            "id": 42477615,
            "node_id": "MDQ6VXNlcjQyNDc3NjE1",
            "avatar_url": "https://avatars.githubusercontent.com/u/42477615?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tracysh",
            "html_url": "https://github.com/tracysh",
            "followers_url": "https://api.github.com/users/tracysh/followers",
            "following_url": "https://api.github.com/users/tracysh/following{/other_user}",
            "gists_url": "https://api.github.com/users/tracysh/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tracysh/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tracysh/subscriptions",
            "organizations_url": "https://api.github.com/users/tracysh/orgs",
            "repos_url": "https://api.github.com/users/tracysh/repos",
            "events_url": "https://api.github.com/users/tracysh/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tracysh/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-02-04T19:05:58Z",
        "updated_at": "2020-02-04T19:05:58Z",
        "author_association": "CONTRIBUTOR",
        "body": "@zealerww There's still work in progress to improve quantized models. The change for the multi-threaded GEMM fixed half of the performance for ConvInteger. There's still a significant cost from the im2col step in the current implementation: for some of the early 3x3 kernel nodes, the im2col time is twice that of the GEMM. \r\n\r\nThe float implementation of convolution that you get with ORT_DISABLE_ALL does better by threading the im2col step with the GEMM operation. The implementation also tiles the im2col operation to avoid needing to instantiate the entire buffer in memory. This has not been done for the integer convolution path.\r\n\r\nIf you enable ORT_ENABLE_ALL, the float convolution goes down a different path that does layout optimizations (the fp32 number above would be closer to 25ms I suspect). The equivalent also needs to be done for quantized convolution to avoid im2col completely. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/582065678/reactions",
            "total_count": 1,
            "+1": 1,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/653347656",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2871#issuecomment-653347656",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2871",
        "id": 653347656,
        "node_id": "MDEyOklzc3VlQ29tbWVudDY1MzM0NzY1Ng==",
        "user": {
            "login": "stale[bot]",
            "id": 26384082,
            "node_id": "MDM6Qm90MjYzODQwODI=",
            "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stale%5Bbot%5D",
            "html_url": "https://github.com/apps/stale",
            "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
            "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
            "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
            "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
            "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
            "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
            "type": "Bot",
            "site_admin": false
        },
        "created_at": "2020-07-03T04:58:20Z",
        "updated_at": "2020-07-03T04:58:20Z",
        "author_association": "NONE",
        "body": "This issue has been automatically marked as stale due to inactivity and will be closed in 7 days if no further activity occurs. If further support is needed, please provide an update and/or more details.\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/653347656/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/656962828",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/2871#issuecomment-656962828",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/2871",
        "id": 656962828,
        "node_id": "MDEyOklzc3VlQ29tbWVudDY1Njk2MjgyOA==",
        "user": {
            "login": "stale[bot]",
            "id": 26384082,
            "node_id": "MDM6Qm90MjYzODQwODI=",
            "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stale%5Bbot%5D",
            "html_url": "https://github.com/apps/stale",
            "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
            "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
            "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
            "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
            "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
            "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
            "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
            "type": "Bot",
            "site_admin": false
        },
        "created_at": "2020-07-11T01:40:56Z",
        "updated_at": "2020-07-11T01:40:56Z",
        "author_association": "NONE",
        "body": "This issue has been automatically closed due to inactivity. Please reactivate if further support is needed.\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/656962828/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]