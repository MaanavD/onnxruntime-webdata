[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/598845402",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/3205#issuecomment-598845402",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/3205",
        "id": 598845402,
        "node_id": "MDEyOklzc3VlQ29tbWVudDU5ODg0NTQwMg==",
        "user": {
            "login": "hariharans29",
            "id": 9969784,
            "node_id": "MDQ6VXNlcjk5Njk3ODQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/9969784?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/hariharans29",
            "html_url": "https://github.com/hariharans29",
            "followers_url": "https://api.github.com/users/hariharans29/followers",
            "following_url": "https://api.github.com/users/hariharans29/following{/other_user}",
            "gists_url": "https://api.github.com/users/hariharans29/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/hariharans29/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/hariharans29/subscriptions",
            "organizations_url": "https://api.github.com/users/hariharans29/orgs",
            "repos_url": "https://api.github.com/users/hariharans29/repos",
            "events_url": "https://api.github.com/users/hariharans29/events{/privacy}",
            "received_events_url": "https://api.github.com/users/hariharans29/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-03-13T17:58:20Z",
        "updated_at": "2020-03-13T17:59:31Z",
        "author_association": "MEMBER",
        "body": "Well the root cause is that there seems to have been a problem with the export to ONNX - \r\n\r\n![image](https://user-images.githubusercontent.com/9969784/76646956-18083400-6519-11ea-89be-c427eb450baf.png)\r\n\r\nThe output shape of the marked Conv node will be - [1, 64, 56, 56] and BatchNorm will propagate that shape to PRelu. The shape of the slope tensor in PRelu should be broadcastable to the input shape. - https://github.com/onnx/onnx/blob/master/docs/Operators.md#prelu. [64] is not broadcastable to  [1, 64, 56, 56].\r\n\r\nEven if this issue is fixed, the model exported from MxNet with BatchNorm will not run. Please see the following for details - \r\nhttps://github.com/onnx/models/issues/156\r\nhttps://github.com/apache/incubator-mxnet/pull/17711\r\n\r\nClosing as this is not a runtime issue. \r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/598845402/reactions",
            "total_count": 2,
            "+1": 0,
            "-1": 2,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/663804005",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/3205#issuecomment-663804005",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/3205",
        "id": 663804005,
        "node_id": "MDEyOklzc3VlQ29tbWVudDY2MzgwNDAwNQ==",
        "user": {
            "login": "ilovewangzeyu",
            "id": 39159121,
            "node_id": "MDQ6VXNlcjM5MTU5MTIx",
            "avatar_url": "https://avatars.githubusercontent.com/u/39159121?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ilovewangzeyu",
            "html_url": "https://github.com/ilovewangzeyu",
            "followers_url": "https://api.github.com/users/ilovewangzeyu/followers",
            "following_url": "https://api.github.com/users/ilovewangzeyu/following{/other_user}",
            "gists_url": "https://api.github.com/users/ilovewangzeyu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ilovewangzeyu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ilovewangzeyu/subscriptions",
            "organizations_url": "https://api.github.com/users/ilovewangzeyu/orgs",
            "repos_url": "https://api.github.com/users/ilovewangzeyu/repos",
            "events_url": "https://api.github.com/users/ilovewangzeyu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ilovewangzeyu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-07-25T03:56:59Z",
        "updated_at": "2020-07-25T03:56:59Z",
        "author_association": "NONE",
        "body": "Hello. Hvae you solved your problem?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/663804005/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/664759846",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/3205#issuecomment-664759846",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/3205",
        "id": 664759846,
        "node_id": "MDEyOklzc3VlQ29tbWVudDY2NDc1OTg0Ng==",
        "user": {
            "login": "cannguyen275",
            "id": 35292523,
            "node_id": "MDQ6VXNlcjM1MjkyNTIz",
            "avatar_url": "https://avatars.githubusercontent.com/u/35292523?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/cannguyen275",
            "html_url": "https://github.com/cannguyen275",
            "followers_url": "https://api.github.com/users/cannguyen275/followers",
            "following_url": "https://api.github.com/users/cannguyen275/following{/other_user}",
            "gists_url": "https://api.github.com/users/cannguyen275/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/cannguyen275/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/cannguyen275/subscriptions",
            "organizations_url": "https://api.github.com/users/cannguyen275/orgs",
            "repos_url": "https://api.github.com/users/cannguyen275/repos",
            "events_url": "https://api.github.com/users/cannguyen275/events{/privacy}",
            "received_events_url": "https://api.github.com/users/cannguyen275/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-07-28T03:49:17Z",
        "updated_at": "2020-07-28T03:49:17Z",
        "author_association": "NONE",
        "body": "@ilovewangzeyu I have not. \r\nMXNet seems to no get along well with onnx then I decide to use pytorch version of my model. Then it works!",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/664759846/reactions",
            "total_count": 2,
            "+1": 2,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/690846860",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/3205#issuecomment-690846860",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/3205",
        "id": 690846860,
        "node_id": "MDEyOklzc3VlQ29tbWVudDY5MDg0Njg2MA==",
        "user": {
            "login": "duonglong289",
            "id": 41854490,
            "node_id": "MDQ6VXNlcjQxODU0NDkw",
            "avatar_url": "https://avatars.githubusercontent.com/u/41854490?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/duonglong289",
            "html_url": "https://github.com/duonglong289",
            "followers_url": "https://api.github.com/users/duonglong289/followers",
            "following_url": "https://api.github.com/users/duonglong289/following{/other_user}",
            "gists_url": "https://api.github.com/users/duonglong289/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/duonglong289/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/duonglong289/subscriptions",
            "organizations_url": "https://api.github.com/users/duonglong289/orgs",
            "repos_url": "https://api.github.com/users/duonglong289/repos",
            "events_url": "https://api.github.com/users/duonglong289/events{/privacy}",
            "received_events_url": "https://api.github.com/users/duonglong289/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2020-09-11T03:10:09Z",
        "updated_at": "2020-09-11T03:10:09Z",
        "author_association": "NONE",
        "body": "The root cause is as @hariharans29 said. I found [this link](https://github.com/apache/incubator-mxnet/commit/f1a6df82a40d1d9e8be6f7c3f9f4dcfe75948bd6) change the function convert PReLU from mxnet to onnxruntime.\r\nIt can fix this bug of mxnet converter. \r\nAfter that,  the model exported from MxNet with BatchNorm might not run because the \"spatial=0\" in BatchNormalization. Following this [link](https://github.com/onnx/models/issues/156#issuecomment-541194670)\r\n\r\nAnother way, i wrote a script for convert the exported model from mxnet to onnx to add a Reshape layer before BatchNormalization layer and it works for me.\r\n```\r\nimport onnx\r\nfrom onnx import checker\r\nimport logging\r\n\r\nmodel = onnx.load(r\"mxnet2onnx_exported_bug_model.onnx\")\r\nonnx_processed_nodes = []\r\nonnx_processed_inputs = []\r\nonnx_processed_outputs = []\r\nonnx_processed_initializers = []\r\n\r\nreshape_node = []\r\n\r\nfor ind, node in enumerate(model.graph.node):\r\n    if node.op_type == \"PRelu\":\r\n        input_node = node.input\r\n        input_bn = input_node[0]\r\n        input_relu_gamma = input_node[1]\r\n        output_node = node.output[0]\r\n    \r\n        input_reshape_name = \"reshape{}\".format(ind)\r\n        slope_number = \"slope{}\".format(ind)\r\n\r\n\r\n        node_reshape = onnx.helper.make_node(\r\n            op_type=\"Reshape\",\r\n            inputs=[input_relu_gamma, input_reshape_name],\r\n            outputs=[slope_number],\r\n            name=slope_number\r\n        )\r\n\r\n        reshape_node.append(input_reshape_name)\r\n        node_relu = onnx.helper.make_node(\r\n            op_type=\"PRelu\",\r\n            inputs=[input_bn, slope_number],\r\n            outputs=[output_node],\r\n            name=output_node\r\n        )\r\n        onnx_processed_nodes.extend([node_reshape, node_relu])\r\n\r\n    \r\n    else:\r\n        # If \"spatial = 0\" does not work for \"BatchNormalization\", change \"spatial=1\"\r\n        # else comment this \"if\" condition\r\n        if node.op_type == \"BatchNormalization\":\r\n            for attr in node.attribute:\r\n                if (attr.name == \"spatial\"):\r\n                    attr.i = 1\r\n        onnx_processed_nodes.append(node)\r\n\r\n\r\nlist_new_inp = []\r\nlist_new_init = []\r\nfor name_rs in reshape_node:\r\n    new_inp = onnx.helper.make_tensor_value_info(\r\n        name=name_rs,\r\n        elem_type=onnx.TensorProto.INT64,\r\n        shape=[4]\r\n    )\r\n    new_init = onnx.helper.make_tensor(\r\n        name=name_rs,\r\n        data_type=onnx.TensorProto.INT64,\r\n        dims=[4],\r\n        vals=[1, -1, 1, 1]\r\n    )\r\n    \r\n    list_new_inp.append(new_inp)\r\n    list_new_init.append(new_init)\r\n    \r\n\r\nfor k, inp in enumerate(model.graph.input):\r\n    if \"relu0_gamma\" in inp.name or \"relu1_gamma\" in inp.name: #or \"relu_gamma\" in inp.name:\r\n        new_reshape = list_new_inp.pop(0)\r\n        onnx_processed_inputs.extend([inp, new_reshape])\r\n    else:     \r\n        onnx_processed_inputs.extend([inp])\r\n\r\nfor k, outp in enumerate(model.graph.output):\r\n    onnx_processed_outputs.extend([outp])\r\n\r\nfor k, init in enumerate(model.graph.initializer):\r\n    if \"relu0_gamma\" in init.name or \"relu1_gamma\" in init.name:\r\n        new_reshape = list_new_init.pop(0)\r\n        onnx_processed_initializers.extend([init, new_reshape])\r\n    else:\r\n        onnx_processed_initializers.extend([init])\r\n\r\n\r\ngraph = onnx.helper.make_graph(\r\n        onnx_processed_nodes,\r\n        \"mxnet_converted_model\",\r\n        onnx_processed_inputs,\r\n        onnx_processed_outputs\r\n    )\r\n\r\ngraph.initializer.extend(onnx_processed_initializers)\r\n\r\n# Check graph\r\nchecker.check_graph(graph)\r\n\r\nonnx_model = onnx.helper.make_model(graph)\r\n\r\n# Write model\r\nstr_input = '3,112,112'\r\ninput_shape = (1,) + tuple( [int(x) for x in str_input.split(',')] )\r\nonnx_file_path = \"mxnet2onnx_model_onnxruntime.onnx\"\r\n\r\nwith open(onnx_file_path, \"wb\") as file_handle:\r\n    serialized = onnx_model.SerializeToString()\r\n    file_handle.write(serialized)\r\n    logging.info(\"Input shape of the model %s \", input_shape)\r\n    logging.info(\"Exported ONNX file %s saved to disk\", onnx_file_path)\r\n\r\nprint(\"Done!!!\")\r\n```\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/690846860/reactions",
            "total_count": 4,
            "+1": 4,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]