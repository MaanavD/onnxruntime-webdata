[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/789297765",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6865#issuecomment-789297765",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6865",
        "id": 789297765,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc4OTI5Nzc2NQ==",
        "user": {
            "login": "tracysh",
            "id": 42477615,
            "node_id": "MDQ6VXNlcjQyNDc3NjE1",
            "avatar_url": "https://avatars.githubusercontent.com/u/42477615?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tracysh",
            "html_url": "https://github.com/tracysh",
            "followers_url": "https://api.github.com/users/tracysh/followers",
            "following_url": "https://api.github.com/users/tracysh/following{/other_user}",
            "gists_url": "https://api.github.com/users/tracysh/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tracysh/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tracysh/subscriptions",
            "organizations_url": "https://api.github.com/users/tracysh/orgs",
            "repos_url": "https://api.github.com/users/tracysh/repos",
            "events_url": "https://api.github.com/users/tracysh/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tracysh/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-03-02T23:27:08Z",
        "updated_at": "2021-03-02T23:27:08Z",
        "author_association": "CONTRIBUTOR",
        "body": "Hello, @chenbohua3, the problem is caused by the fused weights (fusing Conv+BN) getting too small: this results in the CPU doing denormal multiplies and the processor takes several clocks longer to complete math involving denormals. You can search the issues for \"denormal\" and find other instances of this.\r\n\r\nThe runtime does support enabling a \"flush denormals to zero mode\". After changing the above code to do the below, I then see the same time from fast.onnx/slow.onnx. This is the ORT version of calling torch.set_flush_denormal.\r\n\r\n    ort_session_options = onnxruntime.SessionOptions()\r\n    ort_session_options.add_session_config_entry(\"session.set_denormal_as_zero\", \"1\")\r\n    ort_session = onnxruntime.InferenceSession(model_file, ort_session_options)\r\n\r\nThe other option that has been used in the past is to edit the model's weights to clip anything below some threshold to zero. I don't have any pointers to scripts that do this though.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/789297765/reactions",
            "total_count": 3,
            "+1": 3,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/789378228",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6865#issuecomment-789378228",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6865",
        "id": 789378228,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc4OTM3ODIyOA==",
        "user": {
            "login": "chenbohua3",
            "id": 19526090,
            "node_id": "MDQ6VXNlcjE5NTI2MDkw",
            "avatar_url": "https://avatars.githubusercontent.com/u/19526090?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/chenbohua3",
            "html_url": "https://github.com/chenbohua3",
            "followers_url": "https://api.github.com/users/chenbohua3/followers",
            "following_url": "https://api.github.com/users/chenbohua3/following{/other_user}",
            "gists_url": "https://api.github.com/users/chenbohua3/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/chenbohua3/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/chenbohua3/subscriptions",
            "organizations_url": "https://api.github.com/users/chenbohua3/orgs",
            "repos_url": "https://api.github.com/users/chenbohua3/repos",
            "events_url": "https://api.github.com/users/chenbohua3/events{/privacy}",
            "received_events_url": "https://api.github.com/users/chenbohua3/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-03-03T02:28:22Z",
        "updated_at": "2021-03-03T02:49:13Z",
        "author_association": "NONE",
        "body": "@tracysh thanks so much. Directly apply your changes leads to about 4ms gain. And after cliping small values to zero in pytorch, the fast.onnx and slow.onnx run at the same speed.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/789378228/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]