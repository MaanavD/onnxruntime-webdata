[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/796980372",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6978#issuecomment-796980372",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6978",
        "id": 796980372,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc5Njk4MDM3Mg==",
        "user": {
            "login": "HectorSVC",
            "id": 29932710,
            "node_id": "MDQ6VXNlcjI5OTMyNzEw",
            "avatar_url": "https://avatars.githubusercontent.com/u/29932710?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/HectorSVC",
            "html_url": "https://github.com/HectorSVC",
            "followers_url": "https://api.github.com/users/HectorSVC/followers",
            "following_url": "https://api.github.com/users/HectorSVC/following{/other_user}",
            "gists_url": "https://api.github.com/users/HectorSVC/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/HectorSVC/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/HectorSVC/subscriptions",
            "organizations_url": "https://api.github.com/users/HectorSVC/orgs",
            "repos_url": "https://api.github.com/users/HectorSVC/repos",
            "events_url": "https://api.github.com/users/HectorSVC/events{/privacy}",
            "received_events_url": "https://api.github.com/users/HectorSVC/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-03-11T19:20:10Z",
        "updated_at": "2021-03-11T19:20:10Z",
        "author_association": "MEMBER",
        "body": "Could you do some more tests, such as: with dynamic shape input, inference with input data with 8 * 1000 * 100, I suppose the only first inference is slow, following inference should be fast. Which means it's slow only for the first new shape it encountered.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/796980372/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/797207090",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6978#issuecomment-797207090",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6978",
        "id": 797207090,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc5NzIwNzA5MA==",
        "user": {
            "login": "hariharans29",
            "id": 9969784,
            "node_id": "MDQ6VXNlcjk5Njk3ODQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/9969784?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/hariharans29",
            "html_url": "https://github.com/hariharans29",
            "followers_url": "https://api.github.com/users/hariharans29/followers",
            "following_url": "https://api.github.com/users/hariharans29/following{/other_user}",
            "gists_url": "https://api.github.com/users/hariharans29/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/hariharans29/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/hariharans29/subscriptions",
            "organizations_url": "https://api.github.com/users/hariharans29/orgs",
            "repos_url": "https://api.github.com/users/hariharans29/repos",
            "events_url": "https://api.github.com/users/hariharans29/events{/privacy}",
            "received_events_url": "https://api.github.com/users/hariharans29/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-03-12T03:21:00Z",
        "updated_at": "2021-03-12T03:21:00Z",
        "author_association": "MEMBER",
        "body": "If only the first run with a specific input shape is slow and the subsequent runs with the same input shape are faster, this usually means you have a lot of Conv nodes in your model. By default, the logic in the CUDA EP for Conv is to query CuDNN to find the \"most optimal\" Conv algo for a given filter shape/input shape and cache it for subsequent runs. This query takes up the most time in the first run. \r\n\r\nThat is why for most dynamic shape models, users actually set this field (https://github.com/microsoft/onnxruntime/blob/694389a85d35668859c33915849a0c0dd3667969/include/onnxruntime/core/session/onnxruntime_c_api.h#L270) to DEFAULT (the default value is actually EXHAUSTIVE - which asks CuDnn to search exhaustively for the best Conv algo). If DEFAULT is used, CuDNN is no longer queried and the default Conv algo is used. The trade-off involved is that the first run will now be much faster but the subsequent runs ***might*** be a bit slower simply because the default algo may not be the best algo for the filter/input shapes.\r\n\r\nYou can get access to this API by upgrading to 1.6 or the latest 1.7.  ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/797207090/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/797682209",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6978#issuecomment-797682209",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6978",
        "id": 797682209,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc5NzY4MjIwOQ==",
        "user": {
            "login": "tianleiwu",
            "id": 30328909,
            "node_id": "MDQ6VXNlcjMwMzI4OTA5",
            "avatar_url": "https://avatars.githubusercontent.com/u/30328909?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tianleiwu",
            "html_url": "https://github.com/tianleiwu",
            "followers_url": "https://api.github.com/users/tianleiwu/followers",
            "following_url": "https://api.github.com/users/tianleiwu/following{/other_user}",
            "gists_url": "https://api.github.com/users/tianleiwu/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tianleiwu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tianleiwu/subscriptions",
            "organizations_url": "https://api.github.com/users/tianleiwu/orgs",
            "repos_url": "https://api.github.com/users/tianleiwu/repos",
            "events_url": "https://api.github.com/users/tianleiwu/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tianleiwu/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-03-12T18:53:00Z",
        "updated_at": "2021-03-12T18:56:34Z",
        "author_association": "MEMBER",
        "body": "Another possible reason is that graph optimization need shape information to do some fusion, and in some case, static input could get some fusion while dynamic shape will not. \r\n\r\nYou can save the optimized model with a session option as mentioned in https://www.onnxruntime.ai/docs/resources/graph-optimizations.html to compare.\r\n\r\nIf this is the reason, you can use static input to get optimized model, then apply dynamic axes to the optimized model to get \"dynamic\" version of optimized model and use it in inference. That could walkaround the issue.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/797682209/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/799190734",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6978#issuecomment-799190734",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6978",
        "id": 799190734,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc5OTE5MDczNA==",
        "user": {
            "login": "Emiyassstar",
            "id": 19563785,
            "node_id": "MDQ6VXNlcjE5NTYzNzg1",
            "avatar_url": "https://avatars.githubusercontent.com/u/19563785?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Emiyassstar",
            "html_url": "https://github.com/Emiyassstar",
            "followers_url": "https://api.github.com/users/Emiyassstar/followers",
            "following_url": "https://api.github.com/users/Emiyassstar/following{/other_user}",
            "gists_url": "https://api.github.com/users/Emiyassstar/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/Emiyassstar/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/Emiyassstar/subscriptions",
            "organizations_url": "https://api.github.com/users/Emiyassstar/orgs",
            "repos_url": "https://api.github.com/users/Emiyassstar/repos",
            "events_url": "https://api.github.com/users/Emiyassstar/events{/privacy}",
            "received_events_url": "https://api.github.com/users/Emiyassstar/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-03-15T07:39:51Z",
        "updated_at": "2021-03-15T07:39:51Z",
        "author_association": "NONE",
        "body": "yes,I found this, the first run with a specific input shape is slow ,and the subsequent is faster,i found my model has many depthwise conv and pointwise conv nodes ,and when i set cudnn_conv_algo_search to default ,the first run be faster but All sequences run much slower ,so In order to solve this problem ,i must set the sequences to several  fixed  lengths,Is there any better solution ？\r\n\r\nhere is my test\r\n1.static shape, run time230s\r\n2.dynamic shape and padding sequences to three  fixed  lengths ,run time 400s\r\n3, dynamic shape with default conv , run time 300s\r\n\r\n  ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/799190734/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/799588900",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/6978#issuecomment-799588900",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/6978",
        "id": 799588900,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc5OTU4ODkwMA==",
        "user": {
            "login": "askhade",
            "id": 6475296,
            "node_id": "MDQ6VXNlcjY0NzUyOTY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6475296?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/askhade",
            "html_url": "https://github.com/askhade",
            "followers_url": "https://api.github.com/users/askhade/followers",
            "following_url": "https://api.github.com/users/askhade/following{/other_user}",
            "gists_url": "https://api.github.com/users/askhade/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/askhade/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/askhade/subscriptions",
            "organizations_url": "https://api.github.com/users/askhade/orgs",
            "repos_url": "https://api.github.com/users/askhade/repos",
            "events_url": "https://api.github.com/users/askhade/events{/privacy}",
            "received_events_url": "https://api.github.com/users/askhade/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-03-15T17:08:53Z",
        "updated_at": "2021-03-15T17:08:53Z",
        "author_association": "MEMBER",
        "body": "@Emiyassstar : Now that you have narrowed down the reason as Hari mentioned you have 2 options\r\n1. Spend more time in the first run to find the optimal algo and have the subsequent runs run much faster\r\n2. Set the also to default and have all the runs run at the same speed albeit the perf may not be the optimal that you can get for this model. \r\nIs there any reason none of these 2 solutions work for you? Can you elaborate why?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/799588900/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]