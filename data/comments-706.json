[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/476484579",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/706#issuecomment-476484579",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/706",
        "id": 476484579,
        "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NjQ4NDU3OQ==",
        "user": {
            "login": "pranavsharma",
            "id": 2732907,
            "node_id": "MDQ6VXNlcjI3MzI5MDc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2732907?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pranavsharma",
            "html_url": "https://github.com/pranavsharma",
            "followers_url": "https://api.github.com/users/pranavsharma/followers",
            "following_url": "https://api.github.com/users/pranavsharma/following{/other_user}",
            "gists_url": "https://api.github.com/users/pranavsharma/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/pranavsharma/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/pranavsharma/subscriptions",
            "organizations_url": "https://api.github.com/users/pranavsharma/orgs",
            "repos_url": "https://api.github.com/users/pranavsharma/repos",
            "events_url": "https://api.github.com/users/pranavsharma/events{/privacy}",
            "received_events_url": "https://api.github.com/users/pranavsharma/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-03-26T05:48:13Z",
        "updated_at": "2019-03-26T05:48:13Z",
        "author_association": "MEMBER",
        "body": "@shahasad @jignparm can one of you take a look? thanks.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/476484579/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/476810656",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/706#issuecomment-476810656",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/706",
        "id": 476810656,
        "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NjgxMDY1Ng==",
        "user": {
            "login": "dashesy",
            "id": 873905,
            "node_id": "MDQ6VXNlcjg3MzkwNQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/873905?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/dashesy",
            "html_url": "https://github.com/dashesy",
            "followers_url": "https://api.github.com/users/dashesy/followers",
            "following_url": "https://api.github.com/users/dashesy/following{/other_user}",
            "gists_url": "https://api.github.com/users/dashesy/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/dashesy/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/dashesy/subscriptions",
            "organizations_url": "https://api.github.com/users/dashesy/orgs",
            "repos_url": "https://api.github.com/users/dashesy/repos",
            "events_url": "https://api.github.com/users/dashesy/events{/privacy}",
            "received_events_url": "https://api.github.com/users/dashesy/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-03-26T19:26:17Z",
        "updated_at": "2019-03-26T20:23:51Z",
        "author_association": "NONE",
        "body": "According to a colleage who is an expert, this has something to do with C# ToArray optimized for ToArray because ICollection is implemented, whereas ToTensor is different.\r\nAs a result of the optimization the memory copy will be done in a single chunk, instead of a for-loop",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/476810656/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/477334335",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/706#issuecomment-477334335",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/706",
        "id": 477334335,
        "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzMzNDMzNQ==",
        "user": {
            "login": "jignparm",
            "id": 13698702,
            "node_id": "MDQ6VXNlcjEzNjk4NzAy",
            "avatar_url": "https://avatars.githubusercontent.com/u/13698702?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jignparm",
            "html_url": "https://github.com/jignparm",
            "followers_url": "https://api.github.com/users/jignparm/followers",
            "following_url": "https://api.github.com/users/jignparm/following{/other_user}",
            "gists_url": "https://api.github.com/users/jignparm/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jignparm/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jignparm/subscriptions",
            "organizations_url": "https://api.github.com/users/jignparm/orgs",
            "repos_url": "https://api.github.com/users/jignparm/repos",
            "events_url": "https://api.github.com/users/jignparm/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jignparm/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-03-27T20:27:44Z",
        "updated_at": "2019-03-27T20:27:44Z",
        "author_association": "CONTRIBUTOR",
        "body": "@dashesy - as for being 60ms slower, what percentage slower is it (i.e. what it the total running time)? Are you comparing Debug build or Release build? Most performance comparisons should be on release build, with optimizations enabled.\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/477334335/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/477372571",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/706#issuecomment-477372571",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/706",
        "id": 477372571,
        "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzM3MjU3MQ==",
        "user": {
            "login": "dashesy",
            "id": 873905,
            "node_id": "MDQ6VXNlcjg3MzkwNQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/873905?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/dashesy",
            "html_url": "https://github.com/dashesy",
            "followers_url": "https://api.github.com/users/dashesy/followers",
            "following_url": "https://api.github.com/users/dashesy/following{/other_user}",
            "gists_url": "https://api.github.com/users/dashesy/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/dashesy/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/dashesy/subscriptions",
            "organizations_url": "https://api.github.com/users/dashesy/orgs",
            "repos_url": "https://api.github.com/users/dashesy/repos",
            "events_url": "https://api.github.com/users/dashesy/events{/privacy}",
            "received_events_url": "https://api.github.com/users/dashesy/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-03-27T22:32:26Z",
        "updated_at": "2019-03-27T22:32:26Z",
        "author_association": "NONE",
        "body": "It is 190ms vs 130ms, both release build. To try to see the difference make sure the tensor size is 1000,000 floats.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/477372571/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/479753359",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/706#issuecomment-479753359",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/706",
        "id": 479753359,
        "node_id": "MDEyOklzc3VlQ29tbWVudDQ3OTc1MzM1OQ==",
        "user": {
            "login": "jignparm",
            "id": 13698702,
            "node_id": "MDQ6VXNlcjEzNjk4NzAy",
            "avatar_url": "https://avatars.githubusercontent.com/u/13698702?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jignparm",
            "html_url": "https://github.com/jignparm",
            "followers_url": "https://api.github.com/users/jignparm/followers",
            "following_url": "https://api.github.com/users/jignparm/following{/other_user}",
            "gists_url": "https://api.github.com/users/jignparm/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jignparm/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jignparm/subscriptions",
            "organizations_url": "https://api.github.com/users/jignparm/orgs",
            "repos_url": "https://api.github.com/users/jignparm/repos",
            "events_url": "https://api.github.com/users/jignparm/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jignparm/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-04-04T05:17:51Z",
        "updated_at": "2019-04-04T05:17:51Z",
        "author_association": "CONTRIBUTOR",
        "body": "In terms of fastest way to iterate over tensor data, below are the results for some basic trials. Between the 5 different options below, options **1 and 2**  had similar latency of ~**150ms**. Option **3** took **~5200 ms**  while option **4** was  **~6300ms**, and option **5** around  **~5600 ms**. \r\n\r\nOptions **1 and 2** seem to be the best choices at this time. \r\n\r\nNot sure why options **3 and 4** differ in performance, if the returned object is already a DenseTensor and the extra cast should not result in a copy (from what you mentioned above), so we should expect these two options to have similar performance. \r\n\r\nOption **5**, using the pin() method + unsafe pointer operations after casting to DenseTensor was slightly better than option **4**, but worse than option **3**.  One explanation could be that the the cast to DenseTensor **does** involve some overhead, but then the pointer arithmetic is faster than iterating/indexing over Tensor objects, which would explain why this faster than **4**, but slower than **3**.\r\n\r\n            unsafe\r\n            {\r\n              var res1 = resnov.ToArray()[0].AsTensor<float>().ToArray<float>();\r\n              var res2 = resnov.ToArray()[0].AsEnumerable<float>().ToArray();\r\n              var res3 = resnov.ToArray()[0].AsTensor<float>();\r\n              var res4 = resnov.ToArray()[0].AsTensor<float>().ToDenseTensor();\r\n              var res5 = (float*)resnov.ToArray()[0].AsTensor<float>().ToDenseTensor().Buffer.Pin().Pointer\r\n\r\n              // start timer\r\n              // res below is substituted with res1 through res5 above\r\n              foreach (var r in res)  \r\n              {\r\n                  // do something simple\r\n              }\r\n              // stop timer\r\n            }\r\n\r\nIn terms of performance enhancement, the **System.Numerics.Tensor** class is a fundamental type in the OnnxRuntime C# library, so it  cannot be removed easily. The fastest way to access  data seems to be via the AsArray() methods at this time.\r\n\r\nRegarding the other related issue #713, not being able to access large tensor output (>2G), I was able to construct an model output tensor of 1 Billion floats (size=4G ), and access the values via options **1 and 2** above in about **2817 ms**. Option **5** + unsafe pointer operations, also worked successfully, but took  longer at around **52290 ms**.  It seems like the cast  to DenseTensor is taking cycles , but there was no exception processing a large output tensor.\r\n\r\nFor the exception for large output tensor, please attach/forward a minimal example to reproduce the crash, since it cannot be reproduced using the test mentioned above.\r\n\r\n\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/479753359/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/480123882",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/706#issuecomment-480123882",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/706",
        "id": 480123882,
        "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDEyMzg4Mg==",
        "user": {
            "login": "jignparm",
            "id": 13698702,
            "node_id": "MDQ6VXNlcjEzNjk4NzAy",
            "avatar_url": "https://avatars.githubusercontent.com/u/13698702?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jignparm",
            "html_url": "https://github.com/jignparm",
            "followers_url": "https://api.github.com/users/jignparm/followers",
            "following_url": "https://api.github.com/users/jignparm/following{/other_user}",
            "gists_url": "https://api.github.com/users/jignparm/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jignparm/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jignparm/subscriptions",
            "organizations_url": "https://api.github.com/users/jignparm/orgs",
            "repos_url": "https://api.github.com/users/jignparm/repos",
            "events_url": "https://api.github.com/users/jignparm/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jignparm/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2019-04-05T02:02:50Z",
        "updated_at": "2019-04-05T02:08:57Z",
        "author_association": "CONTRIBUTOR",
        "body": "Adding to the options list above, option **6** below only takes **67 ms**, which should be close to the fastest possible. This avoids any data copies, and directly accesses the underlying pinned native memory, which you were initially trying to do. \r\n\r\n    var res6 = (resnov.ToArray()[0].AsTensor<float>() as DenseTensor<float>).Buffer.Span; \r\n\r\nThe **ToDenseTensor()** method in the options below is creating a copy (is not a cast), which explains why it's slow. https://github.com/dotnet/corefx/blob/master/src/System.Numerics.Tensors/src/System/Numerics/Tensors/Tensor.cs#L1179\r\n\r\nPlease reopen for other concerns. ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/480123882/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]