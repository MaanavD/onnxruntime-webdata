[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/892057006",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8591#issuecomment-892057006",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8591",
        "id": 892057006,
        "node_id": "IC_kwDOCVq1mM41K7Wu",
        "user": {
            "login": "TomWildenhain-Microsoft",
            "id": 67606533,
            "node_id": "MDQ6VXNlcjY3NjA2NTMz",
            "avatar_url": "https://avatars.githubusercontent.com/u/67606533?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TomWildenhain-Microsoft",
            "html_url": "https://github.com/TomWildenhain-Microsoft",
            "followers_url": "https://api.github.com/users/TomWildenhain-Microsoft/followers",
            "following_url": "https://api.github.com/users/TomWildenhain-Microsoft/following{/other_user}",
            "gists_url": "https://api.github.com/users/TomWildenhain-Microsoft/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TomWildenhain-Microsoft/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TomWildenhain-Microsoft/subscriptions",
            "organizations_url": "https://api.github.com/users/TomWildenhain-Microsoft/orgs",
            "repos_url": "https://api.github.com/users/TomWildenhain-Microsoft/repos",
            "events_url": "https://api.github.com/users/TomWildenhain-Microsoft/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TomWildenhain-Microsoft/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-08-03T18:12:00Z",
        "updated_at": "2021-08-03T18:12:00Z",
        "author_association": "MEMBER",
        "body": "Hey @peiwenhuang27 your can't just change the input shape by modifying the graph like that once it is converted.  There can be many ops within the graph that depend on the input shape matching what was initially declared.  You'll need to override the shape before converting to onnx.  Can you edit the tf model signature?  You can also override the shape with tf2onnx's --input flag   use -1 to indicate unknown dims",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/892057006/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/892484633",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8591#issuecomment-892484633",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8591",
        "id": 892484633,
        "node_id": "IC_kwDOCVq1mM41MjwZ",
        "user": {
            "login": "peiwenhuang27",
            "id": 45028573,
            "node_id": "MDQ6VXNlcjQ1MDI4NTcz",
            "avatar_url": "https://avatars.githubusercontent.com/u/45028573?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/peiwenhuang27",
            "html_url": "https://github.com/peiwenhuang27",
            "followers_url": "https://api.github.com/users/peiwenhuang27/followers",
            "following_url": "https://api.github.com/users/peiwenhuang27/following{/other_user}",
            "gists_url": "https://api.github.com/users/peiwenhuang27/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/peiwenhuang27/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/peiwenhuang27/subscriptions",
            "organizations_url": "https://api.github.com/users/peiwenhuang27/orgs",
            "repos_url": "https://api.github.com/users/peiwenhuang27/repos",
            "events_url": "https://api.github.com/users/peiwenhuang27/events{/privacy}",
            "received_events_url": "https://api.github.com/users/peiwenhuang27/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-08-04T08:52:12Z",
        "updated_at": "2021-08-04T08:52:12Z",
        "author_association": "NONE",
        "body": "Hi @TomWildenhain-Microsoft thanks for the reply! Sorry for my ignorance, but when I used the input flag `--inputs input0[-1,-1,257],input1[-1,257,-1,1]` to try to override the input shape, tf2onnx seems to have run successfully, part of the log looks like this:\r\n```\r\n2021-08-04 01:34:39,191 - INFO - Using tensorflow=2.5.0, onnx=1.10.1, tf2onnx=1.9.1/8e8c23\r\n2021-08-04 01:34:39,191 - INFO - Using opset <onnx, 11>\r\n2021-08-04 01:34:39,192 - INFO - Apply shape override:\r\n2021-08-04 01:34:39,192 - INFO - \tSet input_noisy:0 shape to [None, None, 257]\r\n2021-08-04 01:34:39,192 - INFO - \tSet input_noisy_norm:0 shape to [None, 257, None, 1]\r\n2021-08-04 01:34:41,986 - INFO - Computed 0 values for constant folding\r\n2021-08-04 01:34:47,385 - INFO - Computed 0 values for constant folding\r\n2021-08-04 01:34:47,395 - INFO - Computed 0 values for constant folding\r\n2021-08-04 01:34:47,417 - INFO - Computed 0 values for constant folding\r\n2021-08-04 01:34:47,425 - INFO - Computed 0 values for constant folding\r\n2021-08-04 01:34:47,640 - INFO - Optimizing ONNX model\r\n```\r\nThen I tried to load the model and print the input shapes:\r\n```\r\ndim {\r\n  dim_param: \"unk__89\"\r\n}\r\ndim {\r\n  dim_param: \"unk__90\"\r\n}\r\ndim {\r\n  dim_value: 257\r\n}\r\n\r\ndim {\r\n  dim_param: \"unk__91\"\r\n}\r\ndim {\r\n  dim_value: 257\r\n}\r\ndim {\r\n  dim_param: \"unk__92\"\r\n}\r\ndim {\r\n  dim_value: 1\r\n}\r\n```\r\nIt looks ok, but when running it still shows the same error message as I attached in the previous comment.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/892484633/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/892856994",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8591#issuecomment-892856994",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8591",
        "id": 892856994,
        "node_id": "IC_kwDOCVq1mM41N-qi",
        "user": {
            "login": "TomWildenhain-Microsoft",
            "id": 67606533,
            "node_id": "MDQ6VXNlcjY3NjA2NTMz",
            "avatar_url": "https://avatars.githubusercontent.com/u/67606533?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TomWildenhain-Microsoft",
            "html_url": "https://github.com/TomWildenhain-Microsoft",
            "followers_url": "https://api.github.com/users/TomWildenhain-Microsoft/followers",
            "following_url": "https://api.github.com/users/TomWildenhain-Microsoft/following{/other_user}",
            "gists_url": "https://api.github.com/users/TomWildenhain-Microsoft/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TomWildenhain-Microsoft/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TomWildenhain-Microsoft/subscriptions",
            "organizations_url": "https://api.github.com/users/TomWildenhain-Microsoft/orgs",
            "repos_url": "https://api.github.com/users/TomWildenhain-Microsoft/repos",
            "events_url": "https://api.github.com/users/TomWildenhain-Microsoft/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TomWildenhain-Microsoft/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-08-04T17:57:10Z",
        "updated_at": "2021-08-04T17:57:10Z",
        "author_association": "MEMBER",
        "body": "In that case then unfortunately the TF model already has propagated the shape information through the graph and applied optimizations based on those assumptions.  Are you able to run the original TF graph on the input that you want?  It is also possible that the model is only trained for inputs of that shape, so it wouldn't work on other sizes.  You can always add a resize node at the top of the graph.  If you have any fully connected layers, those will only work on a specific shape.  What is the type of input data? images? audio?",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/892856994/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/893129438",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8591#issuecomment-893129438",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8591",
        "id": 893129438,
        "node_id": "IC_kwDOCVq1mM41PBLe",
        "user": {
            "login": "peiwenhuang27",
            "id": 45028573,
            "node_id": "MDQ6VXNlcjQ1MDI4NTcz",
            "avatar_url": "https://avatars.githubusercontent.com/u/45028573?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/peiwenhuang27",
            "html_url": "https://github.com/peiwenhuang27",
            "followers_url": "https://api.github.com/users/peiwenhuang27/followers",
            "following_url": "https://api.github.com/users/peiwenhuang27/following{/other_user}",
            "gists_url": "https://api.github.com/users/peiwenhuang27/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/peiwenhuang27/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/peiwenhuang27/subscriptions",
            "organizations_url": "https://api.github.com/users/peiwenhuang27/orgs",
            "repos_url": "https://api.github.com/users/peiwenhuang27/repos",
            "events_url": "https://api.github.com/users/peiwenhuang27/events{/privacy}",
            "received_events_url": "https://api.github.com/users/peiwenhuang27/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-08-05T03:10:34Z",
        "updated_at": "2021-08-05T03:10:34Z",
        "author_association": "NONE",
        "body": "I initialized the TF graph with static input shapes, and intended to convert them to dynamic when using tf2onnx.\r\nOn the other hand, may I ask what you mean by adding a resize node at the top of the graph?\r\n\r\nAlso:\r\n> If you have any fully connected layers, those will only work on a specific shape.\r\n\r\nDoes this mean I cannot train my model with a certain shape, then inference it with another shape? My use case is training the model with (64, 60, 257), (64, 257, 60, 1), and at inference time the data will be shaped as (1, 60, 1), (1, 257, 1, 1). The first dimension is batch size, which is then set to 1 for inference purpose. Because they are audio data, so the third dimension is related to the time sequence length, which cannot be set to the same as during training time.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/893129438/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/894433145",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8591#issuecomment-894433145",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8591",
        "id": 894433145,
        "node_id": "IC_kwDOCVq1mM41T_d5",
        "user": {
            "login": "TomWildenhain-Microsoft",
            "id": 67606533,
            "node_id": "MDQ6VXNlcjY3NjA2NTMz",
            "avatar_url": "https://avatars.githubusercontent.com/u/67606533?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TomWildenhain-Microsoft",
            "html_url": "https://github.com/TomWildenhain-Microsoft",
            "followers_url": "https://api.github.com/users/TomWildenhain-Microsoft/followers",
            "following_url": "https://api.github.com/users/TomWildenhain-Microsoft/following{/other_user}",
            "gists_url": "https://api.github.com/users/TomWildenhain-Microsoft/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TomWildenhain-Microsoft/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TomWildenhain-Microsoft/subscriptions",
            "organizations_url": "https://api.github.com/users/TomWildenhain-Microsoft/orgs",
            "repos_url": "https://api.github.com/users/TomWildenhain-Microsoft/repos",
            "events_url": "https://api.github.com/users/TomWildenhain-Microsoft/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TomWildenhain-Microsoft/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-08-06T18:13:15Z",
        "updated_at": "2021-08-06T18:13:15Z",
        "author_association": "MEMBER",
        "body": "> I initialized the TF graph with static input shapes, and intended to convert them to dynamic when using tf2onnx.\r\n\r\nYes, that will not work.  If you want the shape to be dynamic, you must declare it as such initially.\r\n\r\n> On the other hand, may I ask what you mean by adding a resize node at the top of the graph?\r\n\r\nOne solution for images of unknown sizes is to scale them to the correct size.  If your model only supports 200 x 200 pixel images, for example, you can do inference on images of other sizes by resizing the image first to 200 x 200.  There's an op in ONNX that does this called Resize.  TF has a corresponding op.  Add tf.image.resize to the top of the model.  https://www.tensorflow.org/api_docs/python/tf/image/resize.  However this only works well for images.  The stretched/resized audio won't have the same properties.\r\n\r\n> Does this mean I cannot train my model with a certain shape, then inference it with another shape? My use case is training the model with (64, 60, 257), (64, 257, 60, 1), and at inference time the data will be shaped as (1, 60, 1), (1, 257, 1, 1). The first dimension is batch size, which is then set to 1 for inference purpose. Because they are audio data, so the third dimension is related to the time sequence length, which cannot be set to the same as during training time.\r\n\r\nCorrect.  The batch size can vary, since it does not become one of the matrix dimensions in the fully connected layer, but the other dimension cannot change.  There are a number of methods in deep learning to deal with unknown lengths.  I think for audio you could do an rfft then a sequence of convolutional layers followed by a reduce mean.  You might be able to do a reshape as long as you do an rfft first, but I'm not a model architect.\r\n\r\nhttps://towardsdatascience.com/audio-deep-learning-made-simple-part-1-state-of-the-art-techniques-da1d3dff2504\r\n\r\nBut these are all general ML questions not specific to tf2onnx/onnxruntime, so if you want more info I'd recommend looking up some common audio architectures.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/894433145/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/894434818",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/8591#issuecomment-894434818",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/8591",
        "id": 894434818,
        "node_id": "IC_kwDOCVq1mM41T_4C",
        "user": {
            "login": "TomWildenhain-Microsoft",
            "id": 67606533,
            "node_id": "MDQ6VXNlcjY3NjA2NTMz",
            "avatar_url": "https://avatars.githubusercontent.com/u/67606533?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TomWildenhain-Microsoft",
            "html_url": "https://github.com/TomWildenhain-Microsoft",
            "followers_url": "https://api.github.com/users/TomWildenhain-Microsoft/followers",
            "following_url": "https://api.github.com/users/TomWildenhain-Microsoft/following{/other_user}",
            "gists_url": "https://api.github.com/users/TomWildenhain-Microsoft/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/TomWildenhain-Microsoft/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TomWildenhain-Microsoft/subscriptions",
            "organizations_url": "https://api.github.com/users/TomWildenhain-Microsoft/orgs",
            "repos_url": "https://api.github.com/users/TomWildenhain-Microsoft/repos",
            "events_url": "https://api.github.com/users/TomWildenhain-Microsoft/events{/privacy}",
            "received_events_url": "https://api.github.com/users/TomWildenhain-Microsoft/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-08-06T18:16:09Z",
        "updated_at": "2021-08-06T18:16:09Z",
        "author_association": "MEMBER",
        "body": "@peiwenhuang27 I'm closing this issue.  If you have any problems with tf2onnx, please open an issue there.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/894434818/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]