[
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/976150109",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9843#issuecomment-976150109",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9843",
        "id": 976150109,
        "node_id": "IC_kwDOCVq1mM46Lt5d",
        "user": {
            "login": "fefe982",
            "id": 3244578,
            "node_id": "MDQ6VXNlcjMyNDQ1Nzg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3244578?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/fefe982",
            "html_url": "https://github.com/fefe982",
            "followers_url": "https://api.github.com/users/fefe982/followers",
            "following_url": "https://api.github.com/users/fefe982/following{/other_user}",
            "gists_url": "https://api.github.com/users/fefe982/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/fefe982/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/fefe982/subscriptions",
            "organizations_url": "https://api.github.com/users/fefe982/orgs",
            "repos_url": "https://api.github.com/users/fefe982/repos",
            "events_url": "https://api.github.com/users/fefe982/events{/privacy}",
            "received_events_url": "https://api.github.com/users/fefe982/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-11-23T03:57:38Z",
        "updated_at": "2021-11-23T03:57:38Z",
        "author_association": "NONE",
        "body": "The reason for this might be that, when gathering elements equal to Kth elements, [RadixTopK](https://github.com/microsoft/onnxruntime/blob/4daa14bc74b5378d5fcb0d6de063a9fa8bd42eac/onnxruntime/core/providers/cuda/math/topk_impl.cu#L347) uses the following logic:\r\n```cpp\r\n    } else if (Equal(x, Kth) && equal_quota > 0) {\r\n      auto to_i = TO(output_i);\r\n      V[to_i] = x;\r\n      I[to_i] = x_i;\r\n      ++output_i;\r\n      --equal_quota;\r\n    }\r\n```\r\n\r\nAnd [Equal ](https://github.com/microsoft/onnxruntime/blob/4daa14bc74b5378d5fcb0d6de063a9fa8bd42eac/onnxruntime/core/providers/cuda/math/topk_impl.cu#L178)is defined as:\r\n```cpp\r\n__device__ __inline__ bool Equal(const float& t0, const float& t1) {\r\n  auto t2 = t0 > t1 ? t0 - t1 : t1 - t0;\r\n  return t2 < std::numeric_limits<float>::epsilon();\r\n}\r\n```\r\nWhen Kth is `Inf`,  both `t0` and `t1` might be `Inf`, then `t2` would be `NaN` (`Inf` - `Inf`), which make the result for `Equal` `false`. \r\n\r\nIn this case, elements equal to Kth are never filled, leaving them with random values.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/976150109/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/978655655",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9843#issuecomment-978655655",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9843",
        "id": 978655655,
        "node_id": "IC_kwDOCVq1mM46VRmn",
        "user": {
            "login": "RyanUnderhill",
            "id": 38674843,
            "node_id": "MDQ6VXNlcjM4Njc0ODQz",
            "avatar_url": "https://avatars.githubusercontent.com/u/38674843?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/RyanUnderhill",
            "html_url": "https://github.com/RyanUnderhill",
            "followers_url": "https://api.github.com/users/RyanUnderhill/followers",
            "following_url": "https://api.github.com/users/RyanUnderhill/following{/other_user}",
            "gists_url": "https://api.github.com/users/RyanUnderhill/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/RyanUnderhill/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/RyanUnderhill/subscriptions",
            "organizations_url": "https://api.github.com/users/RyanUnderhill/orgs",
            "repos_url": "https://api.github.com/users/RyanUnderhill/repos",
            "events_url": "https://api.github.com/users/RyanUnderhill/events{/privacy}",
            "received_events_url": "https://api.github.com/users/RyanUnderhill/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-11-25T00:54:36Z",
        "updated_at": "2021-11-25T00:54:36Z",
        "author_association": "MEMBER",
        "body": "Amusing, but the Onnx spec for TopK doesn't mention any behavior for non finite numbers. Is this a valid use case for you? ",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/978655655/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/978769317",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9843#issuecomment-978769317",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9843",
        "id": 978769317,
        "node_id": "IC_kwDOCVq1mM46VtWl",
        "user": {
            "login": "fefe982",
            "id": 3244578,
            "node_id": "MDQ6VXNlcjMyNDQ1Nzg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3244578?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/fefe982",
            "html_url": "https://github.com/fefe982",
            "followers_url": "https://api.github.com/users/fefe982/followers",
            "following_url": "https://api.github.com/users/fefe982/following{/other_user}",
            "gists_url": "https://api.github.com/users/fefe982/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/fefe982/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/fefe982/subscriptions",
            "organizations_url": "https://api.github.com/users/fefe982/orgs",
            "repos_url": "https://api.github.com/users/fefe982/repos",
            "events_url": "https://api.github.com/users/fefe982/events{/privacy}",
            "received_events_url": "https://api.github.com/users/fefe982/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-11-25T02:38:00Z",
        "updated_at": "2021-11-25T02:38:00Z",
        "author_association": "NONE",
        "body": "Yes. Most of the values in the tensor are masked out by -Inf. I met this when not enough finite values are left in the tensor.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/978769317/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/978775333",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9843#issuecomment-978775333",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9843",
        "id": 978775333,
        "node_id": "IC_kwDOCVq1mM46Vu0l",
        "user": {
            "login": "fefe982",
            "id": 3244578,
            "node_id": "MDQ6VXNlcjMyNDQ1Nzg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3244578?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/fefe982",
            "html_url": "https://github.com/fefe982",
            "followers_url": "https://api.github.com/users/fefe982/followers",
            "following_url": "https://api.github.com/users/fefe982/following{/other_user}",
            "gists_url": "https://api.github.com/users/fefe982/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/fefe982/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/fefe982/subscriptions",
            "organizations_url": "https://api.github.com/users/fefe982/orgs",
            "repos_url": "https://api.github.com/users/fefe982/repos",
            "events_url": "https://api.github.com/users/fefe982/events{/privacy}",
            "received_events_url": "https://api.github.com/users/fefe982/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-11-25T02:56:39Z",
        "updated_at": "2021-11-25T02:56:39Z",
        "author_association": "NONE",
        "body": "Even Inf is not a finite number, it is comparable with other finite numbers and with itself. So I think it should be handled properly.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/978775333/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/984934761",
        "html_url": "https://github.com/microsoft/onnxruntime/issues/9843#issuecomment-984934761",
        "issue_url": "https://api.github.com/repos/microsoft/onnxruntime/issues/9843",
        "id": 984934761,
        "node_id": "IC_kwDOCVq1mM46tOlp",
        "user": {
            "login": "RandySheriffH",
            "id": 48490400,
            "node_id": "MDQ6VXNlcjQ4NDkwNDAw",
            "avatar_url": "https://avatars.githubusercontent.com/u/48490400?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/RandySheriffH",
            "html_url": "https://github.com/RandySheriffH",
            "followers_url": "https://api.github.com/users/RandySheriffH/followers",
            "following_url": "https://api.github.com/users/RandySheriffH/following{/other_user}",
            "gists_url": "https://api.github.com/users/RandySheriffH/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/RandySheriffH/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/RandySheriffH/subscriptions",
            "organizations_url": "https://api.github.com/users/RandySheriffH/orgs",
            "repos_url": "https://api.github.com/users/RandySheriffH/repos",
            "events_url": "https://api.github.com/users/RandySheriffH/events{/privacy}",
            "received_events_url": "https://api.github.com/users/RandySheriffH/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-12-02T19:27:59Z",
        "updated_at": "2021-12-02T19:27:59Z",
        "author_association": "MEMBER",
        "body": "@fefe982 - thanks for reporting this, I am fixing the case.",
        "reactions": {
            "url": "https://api.github.com/repos/microsoft/onnxruntime/issues/comments/984934761/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]